<!--?xml version="1.0" encoding="iso-8859-1"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>Irrlicht Engine - A free open source 3d engine</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link rel="stylesheet" href="style.css" type="text/css" />
<!-- (c) 2005 by N.Gebhardt -->
</head>
<body>
<div align="center"><br />
  <table cellspacing="0" class="main">
    <tbody><tr> 
      <td colspan="2" class="logobar"><img alt="Irrlicht Engine logo" src="images/general/irrlichtlogo.gif" width="233" height="60" /></td>
    </tr>
    <tr> 
      <td colspan="2" class="linkbar"><a href="index.html">Home</a> | <a href="phpBB2/index.php">Forum</a> 
        | <a href="docu/index.html" target="_blank">API</a> | <a href="http://www.google.com/custom?domains=irrlicht.sourceforge.net&amp;sitesearch=irrlicht.sourceforge.net" target="_blank">Search</a></td>
    </tr>
    <tr> 
      <td class="sidebar"> <div class="sidebarentry"> 
          <p class="sideBarTitle">Engine</p>
          <a href="index.html">News</a> <a href="features.html">Features</a> <a href="screenshots.html">Screenshots</a> 
          <a href="downloads.html">Downloads</a> <a href="development.html">Development</a>
	  <a href="toolset.html">Tool set</a> 
        </div>
        <div class="sidebarentry"> 
          <p class="sideBarTitle">Documentation</p>
          <a href="faq.html">FAQ</a> <a href="docu/index.html" target="_blank">API</a> 
          <a href="docu.net/index.html" target="_blank">API.NET</a> <a href="tutorials.html">Tutorials</a> 
          <a href="license.html">License</a> <a href="newsarchive.html">News-Archive</a> 
          <a href="http://www.irrlicht3d.org/wiki" target="_blank">Wiki</a> </div>
        <div class="sidebarentry"> 
          <p class="sideBarTitle">Sourceforge</p>
          <a href="http://sourceforge.net/projects/irrlicht/">Project Page</a> 
          <a href="phpBB2/index.php">Forums</a>
	  <a href="shirts.html">Shirts</a> </div>
        <div class="sidebarentry"> 
          <p class="sideBarTitle">Contact</p>
          <a href="links.html">Links</a> <a href="author.html">Author</a> <a href="impressum.html">Impressum</a> </div>
        <p><a href="http://irrlicht.sourceforge.net"><br />
          <img alt="Irrlicht Engine logo button" src="images/general/irrlicht.png" width="88" height="31" border="0" /></a></p>
        <p><a href="http://sourceforge.net"> <img src="http://sourceforge.net/sflogo.php?group_id=74339&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a></p>
        <p> <a href="http://opensource.org/" target="_blank"><img alt="OSI Certified logo" src="images/general/osi-certified-72x60-t.png" width="72" height="60" border="0" /></a> 
        </p>
        <p>  </p></td>
      <td class="mainframe"> <table class="newsbox">
          <tbody><tr> 
            <td class="newscontent"><p><strong>Tutorial: ODE &amp; Irrlicht</strong><br />
                This tutorial was written by Thomas Suter (thanks a lot!), and 
                published on <a href="http://thomas.webtracker.ch/jahia/Jahia/pid/481" target="_blank">this 
                website</a>. This is simply a copy of the page. Please take a 
                look at the original page, if you think this tutorial may be out 
                of date.</p>
              </td>
          </tr>
        </tbody></table>
        <br />
        <table class="newsbox" cellspacing="0">
          <tbody><tr> 
            <td class="newscaption">Lets start!</td>
          </tr>
          <tr> 
            <td class="newscontent"> <div align="left"> 
                <div align="left"> 
                  <table cellspacing="0" cellpadding="0" width="100%" border="0" class="normtable">
                    <tbody>
                      <tr> 
                        <td class="menu_bar" height="1"><img height="1" src="using ODE with Irrlicht-Dateien/spacer.gif" width="1" border="0" /></td>
                      </tr>
                      <tr valign="top" align="left" width="100%"> 
                        <td width="100%" height="100%"> <table cellspacing="3" cellpadding="0" width="100%" bgcolor="#ffffff" border="0" class="normtable">
                            <tbody>
                              <tr> 
                                <td> <table cellspacing="0" cellpadding="0" width="600" bgcolor="#ffffff" border="0" class="normtable">
                                    <tbody>
                                      <tr> 
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"> 
                                                  <h1>Using ODE With Irrlicht</h1>
                                                  <a href="http://thomas.webtracker.ch/jahia/Jahia/pid/481#files" target="_blank"><b>new</b> 
                                                  Source and Binaries for <b>Irrlicht 
                                                  v0.6</b></a> </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">This 
                                                  Tutorial will explain how to 
                                                  integrate the <a href="http://q12.org/ode" target="_new">Open Dynamics 
                                                  Engine</a> (ODE) with <a href="http://irrlicht.sourceforge.net/" target="_new">Irrlicht</a>.<br />
                                                  I will not describe the steps 
                                                  to get ODE running, instead 
                                                  I'll point out some of the tricky 
                                                  stuff needed to start with ODE 
                                                  and Irrlicht. You will however 
                                                  find some detailed comment about 
                                                  ODE compilation etc. in the 
                                                  sources of ODE. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">You 
                                                  will need to download and compile 
                                                  ODE version 0.039 or higher 
                                                  with OPCODE support. If you 
                                                  are developing with MSVC 7 you 
                                                  could also use the libraries 
                                                  which comes with this tutorial, 
                                                  although I strongly recommend 
                                                  to take the time and compile 
                                                  your own version of ODE preferably 
                                                  the CVS version which is always 
                                                  more uptodate than the packaged 
                                                  one. 
                                                  <p>Further more you need of 
                                                    course the Irrlicht SDK, make 
                                                    shure you have the newest 
                                                    version. Although the code 
                                                    described in the tutorial 
                                                    was developed using <b>irrlicht 
                                                    0.6</b> it should be runnable 
                                                    with only minor changes in 
                                                    higher versions. </p></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Before 
                                                  we start with the description 
                                                  of the demo application I'd 
                                                  like every body to read the 
                                                  ODE documentation. If You really 
                                                  want to use ODE You will have 
                                                  to get accustomed to the C API. 
                                                  Read the documentation once 
                                                  or twice :-) </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"> 
                                                  <h2>Bounce</h2>
                                                  We will write an application 
                                                  with a terrain and some cubes 
                                                  that fall down, hopefully bouncing 
                                                  off the terrain.<br />
                                                  The user (player) will be able 
                                                  to travel the world with a flying 
                                                  first person camera using the 
                                                  keys W, S, D and A to go forward, 
                                                  backward, left and right. The 
                                                  mouse will be used to look around 
                                                  in all directions.The TAB key 
                                                  will pause/unpause the simulation 
                                                  and with the ENTER/RETURN key 
                                                  we will lift the cubes to the 
                                                  height of the camera.Pressing 
                                                  the ESCAPE key will end the 
                                                  application. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><img src="images/tutorials/tut-ode.jpg" alt="Bounce " width="260" height="203" border="0" /></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"><b>Project 
                                                  Setup</b> <br /> <br />
                                                  I use Visual Studio .Net 2003 
                                                  so I will describe what I did 
                                                  to setup the project in MSVC<br /> 
                                                  <ul>
                                                    <li>First You start a new 
                                                      <i>Win32 Project</i>. You 
                                                      don't need a console so 
                                                      stick to the project template 
                                                      without console. Make an 
                                                      empty project without any 
                                                      skeleton files.<br />
                                                      <br />
                                                    </li>
                                                    <li>Then You add the ODE <i>include</i> 
                                                      and <i>lib</i> directories 
                                                      to the project paths using 
                                                      the Menu <br />
                                                      <br />
                                                      <i>Tools-Options-Projects-VC++Directories</i>.<br />
                                                      <br />
                                                      Select <i>'Show directories 
                                                      for' - Include files</i> 
                                                      and add the path to Your 
                                                      <i>ODE/include</i> directory.<br />
                                                      <br />
                                                      Then select <i>'Show directories 
                                                      for' - Library files</i> 
                                                      and add the path to Your 
                                                      <i>ODE/lib</i> directory. 
                                                      Make sure that this directory 
                                                      contains the files <b>ode.lib</b> 
                                                      and <b>OPCODE.lib</b><br />
                                                      <br />
                                                    </li>
                                                    <li>Do the corresponding steps 
                                                      for the <i>irrlicht/inlcude</i> 
                                                      directory and the <i>irrlicht.lib</i> 
                                                      file. The Irrlicht DLL must 
                                                      be in a path known by the 
                                                      system if you want to run 
                                                      the application and for 
                                                      debugging. </li>
                                                  </ul>
                                                  That's all for the setup. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"><b>Main 
                                                  Method</b> <br /> <br />
                                                  Because we don't write a console 
                                                  application we must write a 
                                                  special 'main' method as entrypoint 
                                                  for the application. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>int WINAPI WinMain(HINSTANCE hInstance,HINSTANCE hPrevInstance,
                   LPSTR lpCmdLine,int nCmdShow)
{
	Bounce::Bounceable::RunApplication();
	return 0;
}
<font size="-1">BounceMain.cpp, line 12-15</font>
</pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Every 
                                                  thing else should pretty much 
                                                  be the same as with programming 
                                                  in linux or writing a windows 
                                                  console application. You don't 
                                                  need to open a window because 
                                                  irrlicht will do that for us.</td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"><b>Bounceable</b> <br /> <br />
                                                  The class holding all the information 
                                                  for ODE and Irrlicht is the 
                                                  <i>Bounceable</i> class. The 
                                                  static method <i>RunApplication</i> 
                                                  serves as initialisation code 
                                                  and main loop. For a simulation 
                                                  with ODE we need the following 
                                                  members and methods: </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Members:<br /> <ul>
                                                    <li><i>dWorldID world;</i> 
                                                      a handle to the world to 
                                                      which the object will belong 
                                                      to<br />
                                                      <br />
                                                    </li>
                                                    <li><i>dSpaceID space;</i> 
                                                      a handle to the objects 
                                                      space used for collision 
                                                      detection<br />
                                                      <br />
                                                    </li>
                                                    <li><i>dBodyID body;</i> a 
                                                      handle to the body data 
                                                      of the object, the main 
                                                      handle for physical interactions<br />
                                                      <br />
                                                    </li>
                                                    <li><i>dGeomID geom;</i> a 
                                                      handle to the geometry data 
                                                      of the object, the main 
                                                      handle for collision interactions<br />
                                                      <br />
                                                    </li>
                                                    <li><i>dMass mass;</i> the 
                                                      mass of the object </li>
                                                  </ul></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Methods:<br /> <ul>
                                                    <li><i>static void nearCollisionCallback(void* 
                                                      data, dGeomID o1, dGeomID 
                                                      o2);</i> The Collision callback 
                                                      gets called every time ODE 
                                                      decides that 2 geoms are 
                                                      close enough to check for 
                                                      intersection points<br />
                                                      <br />
                                                    </li>
                                                    <li><i>static void QuaternionToEuler(const 
                                                      dQuaternion quaternion,irr::core::vector3df 
                                                      &amp;euler);</i> The conversion 
                                                      method to get irrlicht rotation 
                                                      vectors from ODE quaternions 
                                                      <br />
                                                      <br />
                                                    </li>
                                                    <li><i>void setGeomData(irr::scene::IMesh* 
                                                      m);</i> Convert the irrlicht 
                                                      mesh structure to an OPCODE 
                                                      collision structure for 
                                                      TriMeshes<br />
                                                      <br />
                                                    </li>
                                                    <li><i>void setGeomData();</i> 
                                                      Convert the irrlicht boundingbox 
                                                      structure to an OPCODE collision 
                                                      structure, and define the 
                                                      physical body of the object 
                                                    </li>
                                                  </ul></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"> 
                                                  <h3>Running an ODE Simulation</h3>
                                                  The basic simulation loop looks 
                                                  as follows:<br /> <ol>
                                                    <li>Apply forces, position 
                                                      changes and rotations to 
                                                      the ODE bodies and geometries 
                                                    </li>
                                                    <li>Calculate the collisions 
                                                      and insert one contact joint 
                                                      between the corresponding 
                                                      bodies for each collision. 
                                                    </li>
                                                    <li>Let the simulation calculate 
                                                      one step </li>
                                                    <li>Clear all contact joint 
                                                      informations </li>
                                                    <li>Apply the new positions 
                                                      and rotations to the visual 
                                                      objects </li>
                                                    <li>Loop to point 1 </li>
                                                  </ol></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Since 
                                                  the only object that's controlled 
                                                  by the user is the camera we 
                                                  don't need to apply forces etc. 
                                                  to the ODE bodies, so we just 
                                                  skip step 1. Our simulation 
                                                  loop looks like this:<br /> 
                                                  <br /></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>if(simulate){
   //updateEntitiesBeforePhysics(); 
   <font color="#009900">// build the collision joints for all objects in 'theSpace'</font>
   dSpaceCollide(theSpace,0,&amp;nearCollisionCallback);
   <font color="#009933">// make a simulation step for 'theWorld'
</font>   dWorldStep(theWorld,0.1f); 
   <font color="#009900">//optionally use dWorldStepFast1 instead of dWorldStep</font>
   //dWorldStepFast1(theWorld,0.1,1);
   <font color="#009900">// clean up joints from collisions</font>
   dJointGroupEmpty(theJointGroup);
   <font color="#009933">// apply the new positions and rotations to the scenenodes
</font>   updateEntitiesAfterPhysics();
}
<font size="-1">bounce.cpp, line 136-151</font>
</pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">Because 
                                                  we can set the simulation to 
                                                  pause the whole code is surrounded 
                                                  by an if statement.<br />
                                                  The function <i>dSpaceCollide</i> 
                                                  calculates all collisions for 
                                                  the space with id <i>theSpace</i>. 
                                                  If two geomertries get near 
                                                  enough the function calls our 
                                                  callback method <i><b>nearCollisionCallback</b></i>.<br />
                                                  The function <i>dWorldStep</i> 
                                                  advances the simulation of the 
                                                  world with id <i>theWorld</i> 
                                                  by <i>0.1</i> time steps.<br /> 
                                                  <i>dJointGroupEmpty</i> clears 
                                                  the joints that were generated 
                                                  in our callback method.<br />
                                                  And <i><b>updateEntitiesAfterPhysics</b></i> 
                                                  transfers the new positions 
                                                  and rotations to the visual 
                                                  objects. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>void Bounceable::nearCollisionCallback(void* data, dGeomID o1, dGeomID o2){
  int i=0;
  dBodyID b1=dGeomGetBody(o1);
  dBodyID b2=dGeomGetBody(o2);
  if(b1 &amp;&amp; b2 &amp;&amp; dAreConnectedExcluding(b1,b2,dJointTypeContact))return;
  dContact contact[MAX_CONTACTS];
  for(i=0;i&lt;MAX_CONTACTS;i++){
    contact[i].surface.mode=dContactBounce | dContactSoftCFM;
    contact[i].surface.mu=dInfinity;
    contact[i].surface.mu2=0;
    contact[i].surface.bounce=1e-5f;
    contact[i].surface.bounce_vel=1e-9f;
    contact[i].surface.soft_cfm=1e-6f;
  }
  int numc=dCollide(o1,o2,MAX_CONTACTS,&amp;contact[0].geom,sizeof(dContact));
  if(numc&gt;0){			
    for(i=0;i&lt;numc;i++){		
      dJointID c=dJointCreateContact(theWorld,theJointGroup,&amp;contact[i]);
      dJointAttach(c,b1,b2);
    }
  }
}
<font size="-1">bounce.cpp, line 326-358</font>
</pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">The 
                                                  callback method check first 
                                                  if the two bodies that collide 
                                                  are connected. If they are connected 
                                                  we don't build any extra contact 
                                                  information. Otherwise, we prepare 
                                                  the contact structures. The 
                                                  values of the surface parameters 
                                                  must be set, of course You can 
                                                  do a lot of adjustments and 
                                                  improvements here.<br />
                                                  After that we call the collision 
                                                  function which inspects the 
                                                  geometries in great detail and 
                                                  sets the corresponding collision 
                                                  point into our contact structures. 
                                                  Then we only need to build a 
                                                  new contact joint for each contact 
                                                  that was set. We could of course 
                                                  add some more things here, like 
                                                  extra forces, or play some collision 
                                                  sounds, or start some extra 
                                                  animations...<br />
                                                  If we need a reference to our 
                                                  object, there is the possibility 
                                                  to store such a pointer in the 
                                                  geom structure.Calling<br /> 
                                                  <br /> <i>dGeomSetData(geomid,(void*)mypointer)</i><br /> 
                                                  <br />
                                                  will store the pointer and with 
                                                  <br /> <br /> <i>mypointer=(MyOBJClass*)dGeomGetData(geomid)</i><br /> 
                                                  <br />
                                                  we can get the pointer back. 
                                                </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>void Bounceable::updateEntitiesAfterPhysics(){
  irr::core::vector3df pos;
  irr::core::vector3df rot;
  std::list&lt;BOUNCEABLE&gt;*::iterator iter=NULL;
  for(iter=bounceables.begin();iter!=bounceables.end();++iter){
    Bounceable* entity=(*iter);
    dGeomID geom=entity-&gt;geom;
    if(geom!=0){
      <font color="#009933">// get the new position of the ODE geometry
</font>      dReal* ode_pos=(dReal*)dGeomGetPosition(geom);
      <font color="#009933">// set the position at the scenenode
</font>      pos.set((irr::f32)ode_pos[0],(irr::f32)ode_pos[1],(irr::f32)ode_pos[2]);
      entity-&gt;node-&gt;setPosition(pos);
      <font color="#009900">// get the rotation quaternion</font>
      dQuaternion result;
      dGeomGetQuaternion(geom, result);
      <font color="#009933">// convert it to eulerangles
</font>      QuaternionToEuler(result,rot);
      <font color="#009933">// set the rotation </font>
      entity-&gt;node-&gt;setRotation(rot);			
    }
  }
}
<font size="-1">bounce.cpp, line 174-196</font>
</pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">At 
                                                  last in the simulation loop 
                                                  we transfer the new position 
                                                  and rotation values to the scenenodes. 
                                                  The method <i>updateEntitiesAfterPhysics</i> 
                                                  will do the job. Propagating 
                                                  the position is straight forward 
                                                  but the rotation needs to be 
                                                  converted from quaternions to 
                                                  euler angles. </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>void Bounceable::QuaternionToEuler(const dQuaternion quaternion, vector3df &amp;euler){
  dReal w,x,y,z;
  w=quaternion[0];
  x=quaternion[1];
  y=quaternion[2];
  z=quaternion[3];
  double sqw = w*w;    
  double sqx = x*x;    
  double sqy = y*y;    
  double sqz = z*z; 
  
  euler.Z = (irr::f32) (atan2(2.0 * (x*y + z*w),(sqx - sqy - sqz + sqw))
                        *irr::core::GRAD_PI);
  
  euler.X = (irr::f32) (atan2(2.0 * (y*z + x*w),(-sqx - sqy + sqz + sqw))
                        *irr::core::GRAD_PI);  
  
  euler.Y = (irr::f32) (asin(-2.0 * (x*z - y*w))
                        *irr::core::GRAD_PI);
}
<font size="-1">bounce.cpp, line 359-375</font>
</pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"> 
                                                  <h3>Converting Irrlicht Meshes 
                                                    to ODE TriMesh</h3>
                                                  The mesh conversion isn't difficult 
                                                  all we have to do is keep track 
                                                  of the vertex indices if we 
                                                  have meshes with multiple meshbuffers. 
                                                </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>void Bounceable::setGeomData(irr::scene::IMesh* m){
  <font color="#009933">// do nothing if the mesh or node is NULL
</font>  if(mesh==NULL || node==NULL) return; 
    int i,j,ci,cif,cv;
    indexcount=0;
    vertexcount=0;
    <font color="#009900">// count vertices and indices
</font>    for(i=0;i<mesh->getMeshBufferCount();i++){
      irr::scene::IMeshBuffer* mb=mesh-&gt;getMeshBuffer(i);
      indexcount+=mb-&gt;getIndexCount();
      vertexcount+=mb-&gt;getVertexCount();
    }
    <font color="#009933">// build structure for ode trimesh geom</font>
    vertices=new dVector3[vertexcount];
    indices=new int[indexcount];
    <font color="#009933">// fill trimesh geom</font>
    ci=0; // current index in the indices array
    <font color="#ff0033">cif=0; // offset of the irrlicht-vertex-index in the vetices array</font> 
    cv=0; // current index in the vertices array
    for(i=0;i&lt;m-&gt;getMeshBufferCount();i++){
      irr::scene::IMeshBuffer* mb=mesh-&gt;getMeshBuffer(i);
      <font color="#009900">// fill indices</font>
      irr::u16* mb_indices=mb-&gt;getIndices();
      for(j=0;j<mb->getIndexCount();j++){
        <font color="#009900">// scale the indices from multiple meshbuffers to single index array</font>
        indices[ci]=<font color="#ff0033">cif+mb_indices[j]</font>;
        ci++;
      }
      <font color="#009933">// update the offset for the next meshbuffer</font>
      <font color="#ff0033">cif=cif+mb-&gt;getVertexCount();</font>
      <font color="#009900">// fill vertices</font>
      if(mb-&gt;getVertexType()==irr::video::EVT_STANDARD){
       irr::video::S3DVertex* mb_vertices=
              (irr::video::S3DVertex*)mb-&gt;getVertices();
       for(j=0;j&lt;mb-&gt;getVertexCount();j++){
         vertices[cv][0]=mb_vertices[j].Pos.X;
         vertices[cv][1]=mb_vertices[j].Pos.Y;
         vertices[cv][2]=mb_vertices[j].Pos.Z;
         cv++;
       } 
     }else if(mb-&gt;getVertexType()==irr::video::EVT_2TCOORDS){
       irr::video::S3DVertex2TCoords* mb_vertices=
               (irr::video::S3DVertex2TCoords*)mb-&gt;getVertices();
       for(j=0;j&lt;mb-&gt;getVertexCount();j++){
         vertices[cv][0]=mb_vertices[j].Pos.X;
         vertices[cv][1]=mb_vertices[j].Pos.Y;
         vertices[cv][2]=mb_vertices[j].Pos.Z;
         cv++;
       }    
     } 
  }
  irr::core::vector3df pos=node-&gt;getPosition();
  <font color="#009933">// build the trimesh data
</font>  dTriMeshDataID data=dGeomTriMeshDataCreate();
  dGeomTriMeshDataBuildSimple(data,(dReal*)vertices, 
                      vertexcount, indices, indexcount);
  <font color="#009900">// build the trimesh geom </font>
  geom=dCreateTriMesh(space,data,0,0,0);
  <font color="#009900">// set the geom position </font>
  dGeomSetPosition(geom,pos.X,pos.Y,pos.Z);
  <font color="#009933">// lets have a pointer to our bounceable
  // we could need this in the collision callback</font>
  dGeomSetData(geom,(void*)this); 
  <font color="#009933">// in our application we don't want geoms 
  // converted from meshes to have a body
</font>  dGeomSetBody(geom,0); 
}
<font size="-1">bounce.cpp, line 261-319</font>
</mb-></mesh-></pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"> 
                                                  <h3>Using Irrlicht Boundignboxes 
                                                    to Define ODE Body and Geom</h3>
                                                  If we need to simulate objects 
                                                  with physical behaviour then 
                                                  it is good practice to use geometric 
                                                  primitives for the simulation 
                                                  because they are faster and 
                                                  often accurate enough. In case 
                                                  we should really need collision 
                                                  at mesh level we could always 
                                                  have special ODE-collision-spaces 
                                                  for these meshes and do tranformations 
                                                  and tests only when needed. 
                                                </td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="BORDER-RIGHT: #00ff00 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: #00ff00 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; BORDER-LEFT: #00ff00 1px solid; WIDTH: 600px; PADDING-TOP: 3px; BORDER-BOTTOM: #00ff00 1px solid" cellspacing="0" cellpadding="0" border="0">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left"></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"><pre>void Bounceable::setGeomData(){
  <font color="#009900">// get the boundingbox</font>
  irr::core::aabbox3d<irr::f32> box=node-&gt;getBoundingBox();
  irr::core::vector3df extend=box.getExtend();
  <font color="#009900">// get the position of the scenenode</font>
  irr::core::vector3df pos=node-&gt;getPosition();
  <font color="#009933">// build a box shaped geometry for ODE
</font>  geom=dCreateBox(space,(dReal)extend.X,(dReal)extend.Y,(dReal)extend.Z);
  <font color="#009933">// set the position of the ODE geom
</font>  dGeomSetPosition(geom,pos.X,pos.Y,pos.Z);
  <font color="#009900">// set a pointer to our Bounceable, 
  // this will come in handy when we do more complicated collisions</font>
  dGeomSetData(geom,(void*)this);
  <font color="#009933">// create a body for this object
</font>  body=dBodyCreate(world);
  <font color="#009900">// setup the mass</font>
  dMassSetBox(&amp;mass,5.0,(dReal)extend.X,(dReal)extend.Y,(dReal)extend.Z);
  <font color="#009900">// combine body and mass
</font>  dBodySetMass(body,&amp;mass);
  <font color="#009900">// add the body to the geom</font>
  dGeomSetBody(geom,body);
  <font color="#009900">// set the bodys position (same as geom position)</font>
  dBodySetPosition(body,pos.X,pos.Y,pos.Z);
  dBodySetData(body,(void*)this);
}
<font size="-1">bounce.cpp, line 262-277</font></irr::f32></pre></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                      <tr> 
                                        <td valign="top" align="left"> <table style="WIDTH: 600px" cellspacing="0" cellpadding="0" border="0" class="normtable">
                                            <tbody>
                                              <tr> 
                                                <td class="text" valign="top" align="left">You 
                                                  will get more details if You 
                                                  read the source code. The file 
                                                  <i><b>bounce.h</b></i> gives 
                                                  some information about the aims 
                                                  of the methods and in the file 
                                                  <i><b>bounce.cpp</b></i> You'll 
                                                  find the implementation which 
                                                  shouldn't be too hard to read. 
                                                  <p>Thank You for reading this 
                                                    tutorial and good luck with 
                                                    Your future games, hopefully 
                                                    with ODE support ;-)</p></td>
                                                <td class="text" valign="top" align="left"> </td>
                                                <td class="text" valign="top" align="left"></td>
                                              </tr>
                                            </tbody>
                                          </table></td>
                                      </tr>
                                      <tr> 
                                        <td class="text" colspan="3" hight="3pt;"> </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                  <div align="right"></div></td>
                              </tr>
                            </tbody>
                          </table>
                          <table cellspacing="3" cellpadding="0" width="100%" border="0" class="normtable">
                            <tbody>
                              <tr> 
                                <td> <table cellspacing="0" cellpadding="0" width="100%" border="0" class="normtable">
                                    <tbody>
                                      <tr> 
                                        <td valign="bottom" height="45"><font class="title"><br />
                                          <a name="files" id="files"></a>Files 
                                          </font></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                      </tr>
                                      <tr> 
                                        <td class="menu_bar" colspan="4" height="1"></td>
                                      </tr>
                                      <tr> 
                                        <td colspan="4" height="5"></td>
                                      </tr>
                                      <tr> 
                                        <td class="titlefile" width="10%">Filename 
                                        </td>
                                        <td class="titlefile" width="70%">Description 
                                        </td>
                                        <td class="titlefile" nowrap="nowrap" width="10%">Size 
                                        </td>
                                        <td class="titlefile" width="10%">Date 
                                        </td>
                                      </tr>
                                      <tr> 
                                        <td class="box" style="BACKGROUND-COLOR: #aaff00" valign="top" nowrap="nowrap"><a href="http://thomas.webtracker.ch/jahia/Jahia/engineName/filemanager/pid/481/Bounce.zip;jsessionid=278BBA04B1111A7DC6E9B4A7011387F4?actionreq=actionFileDownload&amp;fid=9912" target="_blank" class="box">Bounce 
                                          (irr v 0.6)</a> </td>
                                        <td class="box" style="BACKGROUND-COLOR: #aaff00" valign="top">Win32 binaries and sources, compiles 
                                          with irrlicht v 0.6 and msvc .net 2003, 
                                          ODE library not included! </td>
                                        <td class="box" style="BACKGROUND-COLOR: #aaff00" valign="top" nowrap="nowrap" align="right">676 Kb 
                                        </td>
                                        <td class="box" style="BACKGROUND-COLOR: #aaff00" valign="top"> 16.03.2004  </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                  <div align="right"><img height="5" src="using ODE with Irrlicht-Dateien/spacer.gif" width="5" /> </div></td>
                              </tr>
                            </tbody>
                          </table></td>
                      </tr>
                    </tbody>
                  </table>
                  <p> </p>
                </div>
                </div>
              </td>
          </tr>
        </tbody></table>
        <p> </p>
        <p> </p></td>
    </tr>
  </tbody></table>  
  <div align="right"><br />
    <a href="http://validator.w3.org/check?uri=referer" target="_blank"><img src="images/general/valid-xhtml10.png" alt="Valid XHTML 1.0!" width="88" height="31" border="0" /></a> 
    <a href="http://jigsaw.w3.org/css-validator/" target="_blank"><img src="images/general/vcss.gif" alt="Valid CSS!" width="88" height="31" border="0" /></a></div>
</div>
<p class="copyrighttext"><br />
  Irrlicht Engine and Irrlicht Engine webpage © 2003-2005 by Nikolaus Gebhardt</p>


</body></html>