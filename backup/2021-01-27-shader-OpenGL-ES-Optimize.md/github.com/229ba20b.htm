---
title : 自动快照存档
---

* TIME: 2021-02-05 22:54:49
* URL: <https://github.com/aras-p/glsl-optimizer>

-----

Skip to content

[ ](https://github.com/)

[ Sign up
](/join?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E&source=header-repo)

  * Why GitHub? 

[Features →](/features)

    * [Mobile →](/mobile)
    * [Actions →](/features/actions)
    * [Codespaces →](/features/codespaces)
    * [Packages →](/features/packages)
    * [Security →](/features/security)
    * [Code review →](/features/code-review/)
    * [Project management →](/features/project-management/)
    * [Integrations →](/features/integrations)
    * [GitHub Sponsors →](/sponsors)
    * [Customer stories →](/customer-stories)
    * [Security →](/security)

  * [Team](/team)
  * [Enterprise](/enterprise)
  * Explore 

    * [Explore GitHub →](/explore)

#### Learn & contribute

    * [Topics →](/topics)
    * [Collections →](/collections)
    * [Trending →](/trending)
    * [Learning Lab →](https://lab.github.com/)
    * [Open source guides →](https://opensource.guide)

#### Connect with others

    * [The ReadME Project →](https://github.com/readme)
    * [Events →](https://github.com/events)
    * [Community forum →](https://github.community)
    * [GitHub Education →](https://education.github.com)
    * [GitHub Stars program →](https://stars.github.com)

  * [Marketplace](/marketplace)
  * Pricing 

[Plans →](/pricing)

    * [Compare plans →](/pricing#feature-comparison)
    * [Contact Sales →](https://enterprise.github.com/contact)
    * [Nonprofit →](/nonprofit)
    * [Education →](https://education.github.com)

![](https://github.githubassets.com/images/search-key-slash.svg)

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

  * No suggested jump to results

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this user  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

[ Sign in ](/login?return_to=%2Faras-p%2Fglsl-optimizer) [ Sign up
](/join?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=aras-p%2Fglsl-
optimizer)

{{ message }}

#  [aras-p](/aras-p) / **[glsl-optimizer](/aras-p/glsl-optimizer) **

  * [ Watch ](/login?return_to=%2Faras-p%2Fglsl-optimizer) [ 120 ](/aras-p/glsl-optimizer/watchers)
  * [ Star ](/login?return_to=%2Faras-p%2Fglsl-optimizer) [ 1.4k ](/aras-p/glsl-optimizer/stargazers)
  * [ Fork ](/login?return_to=%2Faras-p%2Fglsl-optimizer) [ 384 ](/aras-p/glsl-optimizer/network/members)

GLSL optimizer based on Mesa's GLSL compiler. Used in Unity for mobile shader
optimization.

[ View license ](/aras-p/glsl-optimizer/blob/master/license.txt)

[ 1.4k stars ](/aras-p/glsl-optimizer/stargazers) [ 384 forks ](/aras-p/glsl-
optimizer/network/members)

[ Star ](/login?return_to=%2Faras-p%2Fglsl-optimizer)

[ Watch ](/login?return_to=%2Faras-p%2Fglsl-optimizer)

  * [ Code ](/aras-p/glsl-optimizer)
  * [ Issues 38 ](/aras-p/glsl-optimizer/issues)
  * [ Pull requests 10 ](/aras-p/glsl-optimizer/pulls)
  * [ Actions ](/aras-p/glsl-optimizer/actions)
  * [ Projects 0 ](/aras-p/glsl-optimizer/projects)
  * [ Security ](/aras-p/glsl-optimizer/security)
  * [ Insights ](/aras-p/glsl-optimizer/pulse)

More

  * [ Code ](/aras-p/glsl-optimizer)
  * [ Issues ](/aras-p/glsl-optimizer/issues)
  * [ Pull requests ](/aras-p/glsl-optimizer/pulls)
  * [ Actions ](/aras-p/glsl-optimizer/actions)
  * [ Projects ](/aras-p/glsl-optimizer/projects)
  * [ Security ](/aras-p/glsl-optimizer/security)
  * [ Insights ](/aras-p/glsl-optimizer/pulse)

master

[ **3** branches ](/aras-p/glsl-optimizer/branches) [ **0** tags
](/aras-p/glsl-optimizer/tags)

[ Go to file ](/aras-p/glsl-optimizer/find/master) Code

[ ](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone

HTTPS  GitHub CLI

Use Git or checkout with SVN using the web URL.

Work fast with our official CLI. [Learn more](https://cli.github.com).

  * [ Open with GitHub Desktop ](https://desktop.github.com)
  * [ Download ZIP ](/aras-p/glsl-optimizer/archive/master.zip)

#### Launching GitHub Desktop

If nothing happens, [download GitHub Desktop](https://desktop.github.com/) and
try again.

Go back

#### Launching GitHub Desktop

If nothing happens, [download GitHub Desktop](https://desktop.github.com/) and
try again.

Go back

#### Launching Xcode

If nothing happens, [download Xcode](https://developer.apple.com/xcode/) and
try again.

Go back

#### Launching Visual Studio

If nothing happens, [download the GitHub extension for Visual
Studio](https://visualstudio.github.com/) and try again.

Go back

## Latest commit

[
![@aras-p](https://avatars.githubusercontent.com/u/348087?s=60&u=41311731f3f004fab8817c14c0440e09a29caa48&v=4)
](/aras-p)

[aras-p](/aras-p/glsl-optimizer/commits?author=aras-p "View all commits by
aras-p") [Merge pull request](/aras-p/glsl-
optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6 "Merge pull request
#147 from aaronfranke/file-formatting

Add a newline to the end of some files")
[#147](https://github.com/aras-p/glsl-optimizer/pull/147) [from
aaronfranke/file-formatting](/aras-p/glsl-
optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6 "Merge pull request
#147 from aaronfranke/file-formatting

Add a newline to the end of some files")

…

[d78c3d2](/aras-p/glsl-
optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6) [ on 24 Mar 2020
](/aras-p/glsl-optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6)

[Merge pull request](/aras-p/glsl-
optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6)
[#147](https://github.com/aras-p/glsl-optimizer/pull/147) [from
aaronfranke/file-formatting](/aras-p/glsl-
optimizer/commit/d78c3d2f249aa870368ad320905bc954c47704f6)

    
    
    Add a newline to the end of some files

d78c3d2

## Git stats

  * [ **66,913** commits  ](/aras-p/glsl-optimizer/commits/master)

## Files

[Permalink](/aras-p/glsl-
optimizer/tree/d78c3d2f249aa870368ad320905bc954c47704f6)

Failed to load latest commit information.

Type

Name

Latest commit message

Commit time

[contrib](/aras-p/glsl-optimizer/tree/master/contrib "contrib")

[fix off-by-one in glslopt file save](/aras-p/glsl-
optimizer/commit/41fd2989706c90280309bbdac96f3a4bdbdc17e8 "fix off-by-one in
glslopt file save

glslopt was writing an extra byte \(the NULL character\)

to the output file.  Since GLSL files should be plain-text,

this could be a problem in some environments.")

7 years ago

[include](/aras-p/glsl-optimizer/tree/master/include "include")

[Fix windows build (](/aras-p/glsl-
optimizer/commit/921383b3474ecef44131d90ba6c757c7b03bd1d8 "Fix windows build
\(fixes #74\)")[fixes](/aras-p/glsl-
optimizer/commit/921383b3474ecef44131d90ba6c757c7b03bd1d8 "Fix windows build
\(fixes #74\)") [#74](https://github.com/aras-p/glsl-
optimizer/issues/74)[)](/aras-p/glsl-
optimizer/commit/921383b3474ecef44131d90ba6c757c7b03bd1d8 "Fix windows build
\(fixes #74\)")

6 years ago

[projects](/aras-p/glsl-optimizer/tree/master/projects "projects")

[Remove opt_vector_splitting.cpp, not required anymore and has a bug
i…](/aras-p/glsl-optimizer/commit/c47de77806ae9d64eb5175f20f805f8d78a485ce
"Remove opt_vector_splitting.cpp, not required anymore and has a bug in it")

6 years ago

[src](/aras-p/glsl-optimizer/tree/master/src "src")

[Add a newline to the end of some files](/aras-p/glsl-
optimizer/commit/d85fc4038a04e23e0af8ea861a5ad05346b64162 "Add a newline to
the end of some files")

10 months ago

[tests](/aras-p/glsl-optimizer/tree/master/tests "tests")

[Add a newline to the end of some files](/aras-p/glsl-
optimizer/commit/d85fc4038a04e23e0af8ea861a5ad05346b64162 "Add a newline to
the end of some files")

10 months ago

[.gitattributes](/aras-p/glsl-optimizer/blob/master/.gitattributes
".gitattributes")

[Disable autocrlf for Visual Studio project files.](/aras-p/glsl-
optimizer/commit/90a036b337fc41c25ee6ff89eb9422efd3d9f110 "Disable autocrlf
for Visual Studio project files.")

13 years ago

[.gitignore](/aras-p/glsl-optimizer/blob/master/.gitignore ".gitignore")

[Metal support!](/aras-p/glsl-
optimizer/commit/1039baf1bc87b30822fabdf1baec1d0fb4e5ae65 "Metal support!")

6 years ago

[.npmignore](/aras-p/glsl-optimizer/blob/master/.npmignore ".npmignore")

[Fixes for npm install](/aras-p/glsl-
optimizer/commit/0bde8995de4b5b13f36397481aafaad0ea94b94e "Fixes for npm
install")

8 years ago

[.travis.yml](/aras-p/glsl-optimizer/blob/master/.travis.yml ".travis.yml")

[Add build test for node 6 and 7](/aras-p/glsl-
optimizer/commit/d9dc100b7700a6edebcdda709ad424645165375c "Add build test for
node 6 and 7")

4 years ago

[CMakeLists.txt](/aras-p/glsl-optimizer/blob/master/CMakeLists.txt
"CMakeLists.txt")

[Fix CMakeLists.txt for Linux](/aras-p/glsl-
optimizer/commit/76dee89817c9fc5aa763f10ffe54235b2e99a2a6 "Fix CMakeLists.txt
for Linux")

6 years ago

[Changelog.md](/aras-p/glsl-optimizer/blob/master/Changelog.md "Changelog.md")

[Update changelog](/aras-p/glsl-
optimizer/commit/35905d9f0fa0962f8bd92bef6385c0c51fa3b2ab "Update changelog")

4 years ago

[README.md](/aras-p/glsl-optimizer/blob/master/README.md "README.md")

[More prominent "no active development" warning](/aras-p/glsl-
optimizer/commit/4770b71b5116e66485177f71e167c061e5fa6d5b "More prominent "no
active development" warning")

17 months ago

[autogen.sh](/aras-p/glsl-optimizer/blob/master/autogen.sh "autogen.sh")

[build: Fix autogen.sh to allow out-of-tree builds](/aras-p/glsl-
optimizer/commit/1b200d900155722ec696bbd711a38ee0e04c4895 "build: Fix
autogen.sh to allow out-of-tree builds

Reviewed-by: Kenneth Graunke <kenneth@whitecape.org>")

9 years ago

[binding.gyp](/aras-p/glsl-optimizer/blob/master/binding.gyp "binding.gyp")

[using native abstractions for better node compatibility](/aras-p/glsl-
optimizer/commit/ded3900327f5c02214000b1c3b4abd83b22862ba "using native
abstractions for better node compatibility")

7 years ago

[generateParsers.sh](/aras-p/glsl-optimizer/blob/master/generateParsers.sh
"generateParsers.sh")

[fix building flex/bison after upstream merge; rebuild](/aras-p/glsl-
optimizer/commit/a7666b22fb65810a3b1375278030ab93372ce798 "fix building
flex/bison after upstream merge; rebuild")

8 years ago

[license.txt](/aras-p/glsl-optimizer/blob/master/license.txt "license.txt")

[update copyright year](/aras-p/glsl-
optimizer/commit/c00d5c262260bb77ae1c988c23307907be3c8888 "update copyright
year")

8 years ago

[package.json](/aras-p/glsl-optimizer/blob/master/package.json "package.json")

[Update package.json](/aras-p/glsl-
optimizer/commit/16c0e4681c46c899329adfe339d52681aa3d63b1 "Update
package.json")

4 years ago

[removeDeletedByUs.sh](/aras-p/glsl-optimizer/blob/master/removeDeletedByUs.sh
"removeDeletedByUs.sh")

[tweak](/aras-p/glsl-optimizer/commit/f4be68b29a2f080e8ec7e322c374159a9dfc09bb
"tweak")

6 years ago

[target_defaults.gypi](/aras-p/glsl-optimizer/blob/master/target_defaults.gypi
"target_defaults.gypi")

[Add node.js bindings](/aras-p/glsl-
optimizer/commit/7a190d34beef33979f3bb378c9774d4f3ec5c04c "Add node.js
bindings

Added the GYP build system so the GLSL Optimizer could be built using

node-gyp. Created bindings to V8.")

8 years ago

View code

##  README.md

# GLSL optimizer

> ⚠️ As of mid-2016, the project is unlikely to have any significant
> developments. At Unity we are moving to a different shader compilation
> pipeline, with glsl-optimizer is not used. So from my side there won't be
> significant work done on it. ⚠️

A C++ library that takes GLSL shaders, does some GPU-independent optimizations
on them and outputs GLSL or Metal source back. Optimizations are function
inlining, dead code removal, copy propagation, constant folding, constant
propagation, arithmetic optimizations and so on.

Apparently quite a few mobile platforms are pretty bad at optimizing shaders;
and unfortunately they _also_ lack offline shader compilers. So using a GLSL
optimizer offline before can make the shader run much faster on a platform
like that. See performance numbers in [this blog
post](http://aras-p.info/blog/2010/09/29/glsl-optimizer/).

Even for drivers that have decent shader optimization, GLSL optimizer could be
useful to just strip away dead code, make shaders smaller and do uniform/input
reflection offline.

Almost all actual code is [Mesa 3D's
GLSL](http://cgit.freedesktop.org/mesa/mesa/log/) compiler; all this library
does is spits out optimized GLSL or Metal back, and adds GLES type precision
handling to the optimizer.

This GLSL optimizer is made for [Unity's](http://unity3d.com/) purposes and is
built-in starting with Unity 3.0.

GLSL Optimizer is licensed according to the terms of the MIT license.

See [change log here](/aras-p/glsl-optimizer/blob/master/Changelog.md).

## Usage

Visual Studio 2010 (Windows, x86/x64) and Xcode 5+ (Mac, i386) project files
for a static library are provided in `projects/vs2010/glsl_optimizer.sln` and
`projects/xcode5/glsl_optimizer_lib` respectively.

> Note: only the VS and Xcode project files are maintained and should work at
> any time. There's also a cmake and gyp build system for Linux et al., and
> some stuff in contrib folder - all that may or might not work.

For Linux you can use cmake. Just type "cmake . && make" in the root
directory. This will build the optimizer library and some executable binaries.

Interface for the library is `src/glsl/glsl_optimizer.h`. General usage is:

    
    
    ctx = glslopt_initialize(targetVersion);
    for (lots of shaders) {
    	shader = glslopt_optimize (ctx, shaderType, shaderSource, options);
    	if (glslopt_get_status (shader)) {
    		newSource = glslopt_get_output (shader);
    	} else {
    		errorLog = glslopt_get_log (shader);
    	}
    	glslopt_shader_delete (shader);
    }
    glslopt_cleanup (ctx);
    

## Tests

There's a testing suite for catching regressions, see `tests` folder. In VS,
build and run `glsl_optimizer_tests` project; in Xcode use
`projects/xcode5/glsl_optimizer_tests` project. The test executable requires
path to the `tests` folder as an argument.

Each test comes as three text files; input, expected IR dump and expected
optimized GLSL dump. GLES3 tests are also converted into Metal.

If you're making changes to the project and want pull requests accepted
easier, I'd appreciate if there would be no test suite regressions. If you are
implementing a feature, it would be cool to add tests to cover it as well!

## Notes

  * GLSL versions 1.10 and 1.20 are supported. 1.10 is the default, use #version 120 to specify 1.20. Higher GLSL versions might work, but aren't tested now.
  * GLSL ES versions 1.00 and 3.00 are supported.

## Dev Notes

Pulling Mesa upstream:

    
    
    git fetch upstream
    git merge upstream/master
    sh removeDeletedByUs.sh
    # inspect files, git rm unneeded ones, fix conflicts etc.
    # git commit
    

Rebuilding flex/bison parsers:

  * When .y/.l files are changed, the parsers are _not_ rebuilt automatically,
  * Run ./generateParsers.sh to do that. You'll need bison & flex (on Mac, do "Install Command Line Tools" from Xcode)
  * I use bison 2.3 and flex 2.5.35 (in OS X 10.8/10.9)

## About

GLSL optimizer based on Mesa's GLSL compiler. Used in Unity for mobile shader
optimization.

### Topics

[ metal ](/topics/metal "Topic: metal") [ shaders ](/topics/shaders "Topic:
shaders") [ glsl ](/topics/glsl "Topic: glsl") [ optimizer ](/topics/optimizer
"Topic: optimizer") [ cross-compiler ](/topics/cross-compiler "Topic: cross-
compiler")

### Resources

Readme

### License

[ View license ](/aras-p/glsl-optimizer/blob/master/license.txt)

##  [ Releases ](/aras-p/glsl-optimizer/releases)

No releases published

##  [ Packages 0 ](/users/aras-p/packages?repo_name=glsl-optimizer)

No packages published  

##  [ Used by 1 ](/aras-p/glsl-
optimizer/network/dependents?package_id=UGFja2FnZS0xMzA2ODQ2NQ%3D%3D)

  * [ ![@mattdesl](https://avatars.githubusercontent.com/u/1383811?s=88&u=b19282767c457635117f335916f8099f30ed88cd&v=4) @mattdesl / optimize-shader ](/mattdesl/optimize-shader)

##  [ Contributors 270 ](/aras-p/glsl-optimizer/graphs/contributors)

  * [ ![@jrfonseca](https://avatars.githubusercontent.com/u/140183?s=64&v=4) ](/jrfonseca)
  * [ ![@marekolsak](https://avatars.githubusercontent.com/u/1476599?s=64&v=4) ](/marekolsak)
  * [ ![@aras-p](https://avatars.githubusercontent.com/u/348087?s=64&v=4) ](/aras-p)
  * [ ![@MostAwesomeDude](https://avatars.githubusercontent.com/u/118035?s=64&v=4) ](/MostAwesomeDude)
  * [ ![@stereotype441](https://avatars.githubusercontent.com/u/306375?s=64&v=4) ](/stereotype441)
  * [ ![@olvaffe](https://avatars.githubusercontent.com/u/46028?s=64&v=4) ](/olvaffe)
  * [ ![@skeggsb](https://avatars.githubusercontent.com/u/1425239?s=64&v=4) ](/skeggsb)
  * [ ![@krh](https://avatars.githubusercontent.com/u/9175?s=64&v=4) ](/krh)
  * [ ![@mattst88](https://avatars.githubusercontent.com/u/590254?s=64&v=4) ](/mattst88)
  * [ ![@anholt](https://avatars.githubusercontent.com/u/3431811?s=64&v=4) ](/anholt)
  * [ ![@curro](https://avatars.githubusercontent.com/u/1184731?s=64&v=4) ](/curro)

[ \+ 259 contributors ](/aras-p/glsl-optimizer/graphs/contributors)

## Languages

  * [ C++ 76.7% ](/aras-p/glsl-optimizer/search?l=c%2B%2B)
  * [ C 17.2% ](/aras-p/glsl-optimizer/search?l=c)
  * [ Yacc 4.4% ](/aras-p/glsl-optimizer/search?l=yacc)
  * [ LLVM 0.7% ](/aras-p/glsl-optimizer/search?l=llvm)
  * [ Lex 0.5% ](/aras-p/glsl-optimizer/search?l=lex)
  * [ Python 0.3% ](/aras-p/glsl-optimizer/search?l=python)
  * Other 0.2%

  * © 2021 GitHub, Inc.
  * [Terms](https://github.com/site/terms)
  * [Privacy](https://github.com/site/privacy)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Docs](https://docs.github.com)

[ ](https://github.com "GitHub")

  * [Contact GitHub](https://github.com/contact)
  * [Pricing](https://github.com/pricing)
  * [API](https://docs.github.com)
  * [Training](https://services.github.com)
  * [Blog](https://github.blog)
  * [About](https://github.com/about)

You can’t perform that action at this time.

You signed in with another tab or window. [Reload]() to refresh your session.
You signed out in another tab or window. [Reload]() to refresh your session.

