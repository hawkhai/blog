<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="zh" data-hairline="true" data-theme="light" data-react-helmet="data-theme"><head><meta charset="utf-8" /><title>Cmake 语法与实战入门 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" /><meta name="renderer" content="webkit" /><meta name="force-rendering" content="webkit" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg" /><meta data-react-helmet="true" name="keywords" content="CMake,C / C++,Makefile" /><meta data-react-helmet="true" name="description" content="CMakeCMake 是一个跨平台、开源的构建系统。它是一个集软件构建、测试、打包于一身的软件。它使用与平台和编译器独立的配置文件来对软件编译过程进行控制。 现如今，有各种各样的 Make 工具遵循着不同的规范和标准…" /><meta data-react-helmet="true" property="og:title" content="Cmake 语法与实战入门" /><meta data-react-helmet="true" property="og:url" content="https://zhuanlan.zhihu.com/p/267803605" /><meta data-react-helmet="true" property="og:description" content="CMakeCMake 是一个跨平台、开源的构建系统。它是一个集软件构建、测试、打包于一身的软件。它使用与平台和编译器独立的配置文件来对软件编译过程进行控制。 现如今，有各种各样的 Make 工具遵循着不同的规范和标准…" /><meta data-react-helmet="true" property="og:image" content="https://pic4.zhimg.com/v2-c74a1f140a89f867b10081e9524139b5_720w.jpg?source=172ae18b" /><meta data-react-helmet="true" property="og:type" content="article" /><meta data-react-helmet="true" property="og:site_name" content="知乎专栏" /><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" /><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" sizes="152x152" /><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.bbce8f18.png" sizes="120x120" /><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.cbade8f9.png" sizes="76x76" /><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.8f6c52aa.png" sizes="60x60" /><link rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico" /><link rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎" /><link rel="dns-prefetch" href="//static.zhimg.com" /><link rel="dns-prefetch" href="//pic1.zhimg.com" /><link rel="dns-prefetch" href="//pic2.zhimg.com" /><link rel="dns-prefetch" href="//pic3.zhimg.com" /><link rel="dns-prefetch" href="//pic4.zhimg.com" /><style>
.u-safeAreaInset-top {
  height: constant(safe-area-inset-top) !important;
  height: env(safe-area-inset-top) !important;
  
}
.u-safeAreaInset-bottom {
  height: constant(safe-area-inset-bottom) !important;
  height: env(safe-area-inset-bottom) !important;
  
}
</style><link href="https://static.zhihu.com/heifetz/column.app.216a26f4.9c2b2e5a7fd015b4e1d5.css" rel="stylesheet" /><script defer="" crossorigin="anonymous" src="https://unpkg.zhimg.com/@cfe/sentry-script@latest/dist/init.js" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;1721-f07dbb12&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrors&quot;:[&quot;origin message&quot;,&quot;Network request failed&quot;,&quot;Loading chunk&quot;,&quot;这个系统不支持该功能。&quot;,&quot;Can't find variable: webkit&quot;,&quot;Can't find variable: $&quot;,&quot;内存不足&quot;,&quot;out of memory&quot;,&quot;DOM Exception 18&quot;,&quot;The operation is insecure&quot;,&quot;[object Event]&quot;,&quot;[object FileError]&quot;,&quot;[object DOMError]&quot;,&quot;[object Object]&quot;,&quot;拒绝访问。&quot;,&quot;Maximum call stack size exceeded&quot;,&quot;UploadError&quot;,&quot;无法 fetch&quot;,&quot;draft-js&quot;,&quot;缺少 JavaScript 对象&quot;,&quot;componentWillEnter&quot;,&quot;componentWillLeave&quot;,&quot;componentWillAppear&quot;,&quot;getInlineStyleAt&quot;,&quot;getCharacterList&quot;],&quot;whitelistUrls&quot;:[&quot;static.zhihu.com&quot;]}"></script><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="qbubgm">.css-qbubgm{margin-left:0;}</style><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.zswsdid.8c753857d71cd5012d8b.js"></script><link rel="stylesheet" type="text/css" href="https://static.zhihu.com/heifetz/column.user-hover-card.216a26f4.a21a39cedb849406303d.css" /><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.user-hover-card.281221c406251c904b25.js"></script><link rel="stylesheet" type="text/css" href="https://static.zhihu.com/heifetz/column.Labels.216a26f4.7d19d2afdc588e36471f.css" /><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.Labels.263a46c8ef00f69abc32.js"></script><link rel="stylesheet" type="text/css" href="https://static.zhihu.com/heifetz/column.modals.216a26f4.6b0a511460867b1595f8.css" /><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.modals.c7d6be0acbf4940fe64b.js"></script><link rel="stylesheet" type="text/css" href="https://static.zhihu.com/heifetz/column.comments-modals.216a26f4.39d2b57c6fd2cae24672.css" /><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.comments-modals.c2a8b6f89b20820435b7.js"></script><style data-emotion="css"></style><link rel="stylesheet" type="text/css" href="https://static.zhihu.com/heifetz/column.richinput.216a26f4.d7eb544a00018fff1eb6.css" /><script charset="utf-8" src="https://static.zhihu.com/heifetz/column.richinput.5de80e2dcbea6adb7f98.js"></script></head><body class="WhiteBg-body" data-react-helmet="class"><div id="root"><div class="App"><div class="LoadingBar"></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;&quot;}" data-zop="{&quot;authorName&quot;:&quot;Hero&quot;,&quot;itemId&quot;:267803605,&quot;title&quot;:&quot;Cmake 语法与实战入门&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;267803605&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader"><div class="ColumnPageHeader-content"><a class="ZhihuLogoLink" href="//www.zhihu.com" aria-label="知乎"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 30" fill="#0066FF" width="64" height="30"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"/><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"/><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"/></svg></a><div class="ColumnPageHeader-Button"><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--EditSurround" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M18.453 7.992l-1.833-1.65.964-.978a1.223 1.223 0 0 1 1.73-.012l.005.006a1.24 1.24 0 0 1 .007 1.748l-.873.886zm-1.178 1.194l-5.578 5.66-1.935.697a.393.393 0 0 1-.504-.504l.697-1.935 5.488-5.567 1.832 1.65zM7.58 5.848l5.654.006-1.539 1.991-3.666.012A1.02 1.02 0 0 0 7 8.868v7.993c0 .558.46 1.01 1.029 1.01l7.941-.01c.568 0 1.03-.453 1.03-1.012v-4.061l2-1.442v6.002c0 1.397-1.2 2.501-2.62 2.501H7.574C6.153 19.85 5 18.717 5 17.32V8.35c0-1.397 1.16-2.502 2.58-2.502z"/></svg>写文章</button></div></div></div></div></div><img class="TitleImage" src="https://pic4.zhimg.com/v2-c74a1f140a89f867b10081e9524139b5_1440w.jpg?source=172ae18b" alt="Cmake 语法与实战入门" /><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">Cmake 语法与实战入门</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hero" /><meta itemprop="image" content="https://pic1.zhimg.com/v2-7d70060712bf9751c10b034a8580b35b_l.jpg?source=172ae18b" /><meta itemprop="url" content="https://www.zhihu.com/people/hero-ljy" /><meta itemprop="zhihu:followerCount" /><span class="UserLink AuthorInfo-avatarWrapper"><div class="Popover"><div id="Popover7-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover7-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/hero-ljy"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="https://pic1.zhimg.com/v2-7d70060712bf9751c10b034a8580b35b_xs.jpg?source=172ae18b" srcset="https://pic1.zhimg.com/v2-7d70060712bf9751c10b034a8580b35b_l.jpg?source=172ae18b 2x" alt="Hero" /></a></div></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="Popover"><div id="Popover8-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover8-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/hero-ljy">Hero</a></div></div></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"></div></div></div></div></div><div class="LabelContainer-wrapper"></div><div><span class="Voters"><button type="button" class="Button Button--plain">52 人<!-- -->赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="RichText ztext Post-RichText"><h3>CMake</h3><p>CMake 是一个跨平台、开源的构建系统。它是一个集软件构建、测试、打包于一身的软件。它使用与平台和编译器独立的配置文件来对软件编译过程进行控制。</p><p>现如今，有各种各样的 Make 工具遵循着不同的规范和标准，所执行的 Makefile 格式也千差万别。这样就带来了一个严峻的问题：如果软件想跨平台，必须要保证能够在不同平台编译。针对每一种Make工具写一遍Makefile显然非常浪费时间。</p><p>CMake 就是针对上面问题所设计的工具：首先，它允许开发者编写一种平台无关的 CMakeList.txt 文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 Makefile 和工程文件。</p><p>在 linux 平台下使用 CMake 生成 Makefile 并编译的流程如下：</p><ol><li>编写 CMake 配置文件 CMakeLists.txt 。</li><li>执行命令 <code>cmake PATH</code> 或者 <code>ccmake PATH</code> 生成 Makefile（<code>ccmake</code> 和 <code>cmake</code> 的区别在于前者提供了一个交互式的界面）。其中， <code>PATH</code> 是 CMakeLists.txt 所在的目录。</li><li>使用 <code>make</code> 命令进行编译。</li></ol><p class="ztext-empty-paragraph"><br /></p><h3>语法</h3><ul><li><b>指定cmake最小版本</b></li></ul><div class="highlight"><pre><code class="language-cpp-objdump">cmake_minimum_required(VERSION 3.4.1)</code></pre></div><p>在有些情况下，如果 CMakeLists.txt 文件中使用了一些高版本 cmake 特有的一些命令的时候，就需要加上这样一行，提醒用户升级到该版本之后再执行 cmake。</p><ul><li><b>设置项目名称</b></li></ul><div class="highlight"><pre><code class="language-text">project(demo)</code></pre></div><p>最好写上，它会引入两个变量 demo_BINARY_DIR 和 demo_SOURCE_DIR，同时，cmake 自动定义了两个等价的变量 PROJECT_BINARY_DIR 和 PROJECT_SOURCE_DIR。</p><ul><li><b>设置编译类型</b></li></ul><div class="highlight"><pre><code class="language-text">add_executable(demo demo.cpp) # 生成可执行文件
add_library(common STATIC util.cpp) # 生成静态库
add_library(common SHARED util.cpp) # 生成动态库或共享库</code></pre></div><p>add_library 默认生成是静态库，通过以上命令生成文件名字，</p><p>在 Linux 下是：demo  libcommon.a  libcommon.so</p><p>在 Windows 下是：demo.exe  common.lib  common.dll</p><ul><li><b>指定编译包含的源文件 </b></li></ul><ol><li>明确指出包含哪些源文件</li></ol><div class="highlight"><pre><code class="language-text">add_library(demo demo.cpp test.cpp util.cpp)</code></pre></div><p>2. 搜索所有的cpp文件</p><p>aux_source_directory(dir VAR) 发现一个目录(dir)下所有的源代码文件并将列表存储在一个变量(VAR)中。</p><div class="highlight"><pre><code class="language-cpp-objdump">aux_source_directory(. SRC_LIST) # 搜索当前目录下的所有.cpp文件
add_library(demo ${SRC_LIST})</code></pre></div><p>3. 自定义搜索规则</p><div class="highlight"><pre><code class="language-text">file(GLOB SRC_LIST "*.cpp" "protocol/*.cpp")
add_library(demo ${SRC_LIST})
# 或者
file(GLOB SRC_LIST "*.cpp")
file(GLOB SRC_PROTOCOL_LIST "protocol/*.cpp")
add_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})
# 或者
aux_source_directory(. SRC_LIST)
aux_source_directory(protocol SRC_PROTOCOL_LIST)
add_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})</code></pre></div><ul><li><b>查找指定的库文件</b></li></ul><p>find_library(VAR name path)查找到指定的预编译库，并将它的路径存储在变量中。<br />默认的搜索路径为 cmake 包含的系统库，因此如果是 NDK 的公共库只需要指定库的name 即可（不需path）。</p><div class="highlight"><pre><code class="language-text">find_library(log-lib,log)</code></pre></div><p>类似的命令还有 find_file()、find_path()、find_program()、find_package()。</p><ul><li><b>设置包含的目录</b></li></ul><div class="highlight"><pre><code class="language-text">include_directories(
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)</code></pre></div><ul><li><b>设置target需要链接的库</b></li></ul><div class="highlight"><pre><code class="language-text">target_link_libraries( # 目标库 demo # 目标库需要链接的库 ${log-lib} )</code></pre></div><p>在 Windows 下，系统会根据链接库目录，搜索xxx.lib 文件，Linux 下会搜索 xxx.so 或者 xxx.a 文件，如果都存在会优先链接动态库（so 后缀）。</p><ol><li>指定链接动态库或静态库</li></ol><div class="highlight"><pre><code class="language-text">target_link_libraries(demo libface.a) # 链接libface.a
target_link_libraries(demo libface.so) # 链接libface.so</code></pre></div><p>2. 指定全路径</p><div class="highlight"><pre><code class="language-text">target_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.a)
target_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.so)</code></pre></div><p>3. 指定链接多个库</p><div class="highlight"><pre><code class="language-text">target_link_libraries(demo
    ${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.a
    boost_system.a
    boost_thread
    pthread)</code></pre></div><ul><li><b>设置变量</b></li></ul><ol><li>set 直接设置变量的值</li></ol><div class="highlight"><pre><code class="language-text">set(SRC_LIST main.cpp test.cpp)
add_executable(demo ${SRC_LIST})</code></pre></div><p>2. set 追加设置变量的值</p><div class="highlight"><pre><code class="language-text">set(SRC_LIST main.cpp)
set(SRC_LIST ${SRC_LIST} test.cpp)
add_executable(demo ${SRC_LIST})</code></pre></div><ul><li><b>常用变量</b></li></ul><p>PROJECT_SOURCE_DIR：工程的根目录</p><p>PROJECT_BINARY_DIR：运行cmake命令的目录，通常为${PROJECT_SOURCE_DIR}/build</p><p>PROJECT_NAME：返回通过 project 命令定义的项目名称</p><p>CMAKE_CURRENT_SOURCE_DIR：当前处理的 CMakeLists.txt 所在的路径</p><p>CMAKE_CURRENT_BINARY_DIR：target 编译目录</p><p>CMAKE_CURRENT_LIST_DIR：CMakeLists.txt 的完整路径</p><p>EXECUTABLE_OUTPUT_PATH：重新定义目标二进制可执行文件的存放位置</p><p>LIBRARY_OUTPUT_PATH：重新定义目标链接库文件的存放位置</p><p class="ztext-empty-paragraph"><br /></p><h3>实战</h3><h3>单个源文件</h3><p>(源代码所在目录：Demo1)</p><p>假设现在我们的项目中只有一个源文件<a href="https://link.zhihu.com/?target=http%3A//main.cc" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">main.cc</span><span class="invisible"></span></a>，该程序的用途是计算一个数的指数幂。</p><div class="highlight"><pre><code class="language-text">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

/**
 * power - Calculate the power of number.
 * @param base: Base value.
 * @param exponent: Exponent value.
 *
 * @return base raised to the power exponent.
 */
double power(double base, int exponent)
{
    int result = base;
    int i;

    if (exponent == 0) {
        return 1;
    }
    
    for(i = 1; i &lt; exponent; ++i){
        result = result * base;
    }

    return result;
}

int main(int argc, char *argv[])
{
    if (argc &lt; 3){
        printf("Usage: %s base exponent \n", argv[0]);
        return 1;
    }
    double base = atof(argv[1]);
    int exponent = atoi(argv[2]);
    double result = power(base, exponent);
    printf("%g ^ %d is %g\n", base, exponent, result);
    return 0;
}</code></pre></div><p>首先编写 CMakeLists.txt 文件，并保存在与<a href="https://link.zhihu.com/?target=http%3A//mian.cc" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">mian.cc</span><span class="invisible"></span></a>源文件同个目录下：</p><div class="highlight"><pre><code class="language-text"># CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo1)

# 指定生成目标
add_executable(Demo main.cc)</code></pre></div><p>CMakeLists.txt 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。符号 <code>#</code> 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。</p><p>对于上面的 CMakeLists.txt 文件，依次出现了几个命令：</p><ol><li><code>cmake_minimum_required</code>：指定运行此配置文件所需的 CMake 的最低版本；</li><li><code>project</code>：参数值是 <code>Demo1</code>，该命令表示项目的名称是 <code>Demo1</code> 。</li><li><code>add_executable</code>： 将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件。</li></ol><p>之后，在当前目录执行<code>cmake .</code>，得到 Makefile 后再使用<code>make</code>命令编译得到 Demo1 可执行文件。</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo1]$ cmake .
-- The C compiler identification is GNU 4.8.2
-- The CXX compiler identification is GNU 4.8.2
-- Check for working C compiler: /usr/sbin/cc
-- Check for working C compiler: /usr/sbin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working CXX compiler: /usr/sbin/c++
-- Check for working CXX compiler: /usr/sbin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Configuring done
-- Generating done
-- Build files have been written to: /home/ehome/Documents/programming/C/power/Demo1
[ehome@xman Demo1]$ make
Scanning dependencies of target Demo
[100%] Building C object CMakeFiles/Demo.dir/main.cc.o
Linking C executable Demo
[100%] Built target Demo
[ehome@xman Demo1]$ ./Demo 5 4
5 ^ 4 is 625
[ehome@xman Demo1]$ ./Demo 7 3
7 ^ 3 is 343
[ehome@xman Demo1]$ ./Demo 2 10
2 ^ 10 is 1024</code></pre></div><h3>多个源文件</h3><p>(源代码所在目录Demo2)</p><p>上面的例子只有单个源文件。现在假如把<code>power</code>函数单独写进一个名为<code>MathFunctions.c</code>的源文件里，使得这个工程变成如下的形式：</p><div class="highlight"><pre><code class="language-text">/Demo2
    |
    +--- main.cc
    |
    +--- MathFunctions.cc
    |
    +--- MathFunctions.h</code></pre></div><p>这个时候，CMakeLists.txt 可以改成如下的形式：</p><div class="highlight"><pre><code class="language-text"># CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo2)

# 指定生成目标
add_executable(Demo main.cc MathFunctions.cc)</code></pre></div><p>唯一的改动只是在<code>add_executable</code>命令中增加了一个<code>MathFunctions.cc</code>源文件。这样写当然没什么问题，但是如果源文件很多，把所有源文件的名字都加进去将是一件烦人的工作。更省事的方法是使用<code>aux_source_directory</code>命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：</p><div class="highlight"><pre><code class="language-text">aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</code></pre></div><p>因此，可以修改 CMakeLists.txt 如下：</p><div class="highlight"><pre><code class="language-text"># CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo2)

# 查找当前目录下的所有源文件
# 并将名称保存到 DIR_SRCS 变量
aux_source_directory(. DIR_SRCS)

# 指定生成目标
add_executable(Demo ${DIR_SRCS})</code></pre></div><p>这样，CMake 会将当前目录所有源文件的文件名赋值给变量<code>DIR_SRCS</code>，再指示变量<code>DIR_SRCS</code>中的源文件需要编译成一个名称为 Demo 的可执行文件。</p><h3>多个目录，多个源文件</h3><p>(源代码所在目录Demo3)</p><p>现在进一步将 MathFunctions.h 和<a href="https://link.zhihu.com/?target=http%3A//MathFunctions.cc" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">MathFunctions.cc</span><span class="invisible"></span></a>文件移动到 math 目录下。</p><div class="highlight"><pre><code class="language-text">./Demo3
    |
    +--- main.cc
    |
    +--- math/
          |
          +--- MathFunctions.cc
          |
          +--- MathFunctions.h</code></pre></div><p>对于这种情况，需要分别在项目根目录 Demo3 和 math 目录里各编写一个 CMakeLists.txt 文件。为了方便，我们可以先将 math 目录里的文件编译成静态库再由 main 函数调用。</p><p>根目录中的 CMakeLists.txt ：</p><div class="highlight"><pre><code class="language-text"># CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo3)

# 查找当前目录下的所有源文件
# 并将名称保存到 DIR_SRCS 变量
aux_source_directory(. DIR_SRCS)

# 添加 math 子目录
add_subdirectory(math)

# 指定生成目标 
add_executable(Demo ${DIR_SRCS})

# 添加链接库
target_link_libraries(Demo MathFunctions)</code></pre></div><p>该文件添加了下面的内容: 第3行，使用命令 <code>add_subdirectory</code> 指明本项目包含一个子目录 math，这样 math 目录下的 CMakeLists.txt 文件和源代码也会被处理 。第6行，使用命令 <code>target_link_libraries</code> 指明可执行文件 main 需要连接一个名为 MathFunctions 的链接库 。</p><p>子目录中的 CMakeLists.txt：</p><div class="highlight"><pre><code class="language-text"># 查找当前目录下的所有源文件
# 并将名称保存到 DIR_LIB_SRCS 变量
aux_source_directory(. DIR_LIB_SRCS)

# 生成链接库
add_library (MathFunctions ${DIR_LIB_SRCS})</code></pre></div><p>在该文件中使用命令<code>add_library</code>将 src 目录中的源文件编译为静态链接库。</p><h3>自定义编译选项</h3><p>(源代码所在目录Demo4)</p><p>CMake 允许为项目增加编译选项，从而可以根据用户的环境和需求选择最合适的编译方案。</p><p>例如，可以将 MathFunctions 库设为一个可选的库，如果该选项为 <code>ON</code> ，就使用该库定义的数学函数来进行运算。否则就调用标准库中的数学函数库。</p><p>我们要做的第一步是在顶层的 CMakeLists.txt 文件中添加该选项：</p><div class="highlight"><pre><code class="language-text"># CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo4)

# 加入一个配置头文件，用于处理 CMake 对源码的设置
configure_file (
  "${PROJECT_SOURCE_DIR}/config.h.in"
  "${PROJECT_BINARY_DIR}/config.h"
  )

# 是否使用自己的 MathFunctions 库
option (USE_MYMATH
       "Use provided math implementation" ON) # 设置为ON，或OFF

# 是否加入 MathFunctions 库
if (USE_MYMATH)
  include_directories ("${PROJECT_SOURCE_DIR}/math")
  add_subdirectory (math)  
  set (EXTRA_LIBS ${EXTRA_LIBS} MathFunctions)
endif (USE_MYMATH)

# 查找当前目录下的所有源文件
# 并将名称保存到 DIR_SRCS 变量
aux_source_directory(. DIR_SRCS)

# 指定生成目标
add_executable(Demo ${DIR_SRCS})
target_link_libraries (Demo  ${EXTRA_LIBS})</code></pre></div><p>其中：</p><ol><li>第7行的 <code>configure_file</code> 命令用于加入一个配置头文件 config.h ，这个文件由 CMake 从config.h.in 生成，通过这样的机制，将可以通过预定义一些参数和变量来控制代码的生成。</li><li>第13行的 <code>option</code> 命令添加了一个 <code>USE_MYMATH</code> 选项，并且默认值为 <code>ON</code> 。</li><li>第17行根据 <code>USE_MYMATH</code> 变量的值来决定是否使用我们自己编写的 MathFunctions 库。</li></ol><p>之后，修改<a href="https://link.zhihu.com/?target=http%3A//main.cc" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">main.cc</span><span class="invisible"></span></a>文件，让其根据<code>USE_MYMATH</code>的预定义值来决定是否调用标准库还是 MathFunctions 库：</p><div class="highlight"><pre><code class="language-text">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "config.h"

#ifdef USE_MYMATH
  #include "math/MathFunctions.h"
#else
  #include &lt;math.h&gt;
#endif


int main(int argc, char *argv[])
{
    if (argc &lt; 3){
        printf("Usage: %s base exponent \n", argv[0]);
        return 1;
    }
    double base = atof(argv[1]);
    int exponent = atoi(argv[2]);
    
#ifdef USE_MYMATH
    printf("Now we use our own Math library. \n");
    double result = power(base, exponent);
#else
    printf("Now we use the standard library. \n");
    double result = pow(base, exponent);
#endif
    printf("%g ^ %d is %g\n", base, exponent, result);
    return 0;
}</code></pre></div><p>上面的程序值得注意的是第2行，这里引用了一个 config.h 文件，这个文件预定义了<code>USE_MYMATH</code>的值。但我们并不直接编写这个文件，为了方便从 CMakeLists.txt 中导入配置，我们编写一个config.h.in文件，内容如下：</p><div class="highlight"><pre><code class="language-text">#cmakedefine USE_MYMATH</code></pre></div><p>这样 CMake 会自动根据 CMakeLists 配置文件中的设置自动生成 config.h 文件。</p><p>为了便于交互式的选择该变量的值，可以使用<code>ccmake</code>命令（也可以使用<code>cmake -i</code>命令，该命令会提供一个会话式的交互式配置界面）。</p><h3>安装和测试</h3><p>(源代码所在目录Demo5)</p><p>首先先在 math/CMakeLists.txt 文件里添加下面两行：</p><div class="highlight"><pre><code class="language-text"># 指定 MathFunctions 库的安装路径
install (TARGETS MathFunctions DESTINATION bin)
install (FILES MathFunctions.h DESTINATION include)</code></pre></div><p>指明 MathFunctions 库的安装路径。之后同样修改根目录的 CMakeLists 文件，在末尾添加下面几行：</p><div class="highlight"><pre><code class="language-text"># 指定安装路径
install (TARGETS Demo DESTINATION bin)
install (FILES "${PROJECT_BINARY_DIR}/config.h"
         DESTINATION include)</code></pre></div><p>通过上面的定制，生成的 Demo 文件和 MathFunctions 函数库 libMathFunctions.o 文件将会被复制到<code>/usr/local/bin</code>中，而 MathFunctions.h 和生成的 config.h 文件则会被复制到<code>/usr/local/include</code>中。我们可以验证一下（顺带一提的是，这里的<code>/usr/local/</code>是默认安装到的根目录，可以通过修改<code>CMAKE_INSTALL_PREFIX</code>变量的值来指定这些文件应该拷贝到哪个根目录）：</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo5]$ sudo make install
[ 50%] Built target MathFunctions
[100%] Built target Demo
Install the project...
-- Install configuration: ""
-- Installing: /usr/local/bin/Demo
-- Installing: /usr/local/include/config.h
-- Installing: /usr/local/bin/libMathFunctions.a
-- Up-to-date: /usr/local/include/MathFunctions.h
[ehome@xman Demo5]$ ls /usr/local/bin
Demo  libMathFunctions.a
[ehome@xman Demo5]$ ls /usr/local/include
config.h  MathFunctions.h</code></pre></div><p>添加测试同样很简单。CMake 提供了一个称为 CTest 的测试工具。我们要做的只是在项目根目录的 CMakeLists 文件中调用一系列的<code>add_test</code>命令。</p><div class="highlight"><pre><code class="language-text"># 启用测试
enable_testing()

# 测试程序是否成功运行
add_test (test_run Demo 5 2)

# 测试帮助信息是否可以正常提示
add_test (test_usage Demo)
set_tests_properties (test_usage
  PROPERTIES PASS_REGULAR_EXPRESSION "Usage: .* base exponent")

# 测试 5 的平方
add_test (test_5_2 Demo 5 2)

set_tests_properties (test_5_2
 PROPERTIES PASS_REGULAR_EXPRESSION "is 25")

# 测试 10 的 5 次方
add_test (test_10_5 Demo 10 5)

set_tests_properties (test_10_5
 PROPERTIES PASS_REGULAR_EXPRESSION "is 100000")</code></pre></div><p>上面的代码包含了三个测试。第一个测试<code>test_run</code>用来测试程序是否成功运行并返回 0 值。剩下的两个测试分别用来测试 5 的 平方、10 的 5 次方是否都能得到正确的结果。其中<code>PASS_REGULAR_EXPRESSION</code>用来测试输出是否包含后面跟着的字符串。</p><p>如果要测试更多的输入数据，像上面那样一个个写测试用例未免太繁琐。这时可以通过编写宏来实现：</p><div class="highlight"><pre><code class="language-text"># 定义一个宏，用来简化测试工作
macro (do_test arg1 arg2 result)
  add_test (test_${arg1}_${arg2} Demo ${arg1} ${arg2})
  set_tests_properties (test_${arg1}_${arg2}
    PROPERTIES PASS_REGULAR_EXPRESSION ${result})
endmacro (do_test)
 
# 使用该宏进行一系列的数据测试
do_test (5 2 "is 25")
do_test (10 5 "is 100000")</code></pre></div><h3>支持gdb</h3><p>让 CMake 支持 gdb 的设置也很容易，只需要指定<code>Debug</code>模式下开启<code>-g</code>选项：</p><div class="highlight"><pre><code class="language-text">set(CMAKE_BUILD_TYPE "Debug")
set(CMAKE_CXX_FLAGS_DEBUG "$ENV{CXXFLAGS} -O0 -Wall -g -ggdb")
set(CMAKE_CXX_FLAGS_RELEASE "$ENV{CXXFLAGS} -O3 -Wall")</code></pre></div><p>之后可以直接对生成的程序使用 gdb 来调试。</p><h3>添加版本号</h3><p>(源代码所在目录Demo7)</p><p>给项目添加和维护版本号是一个好习惯，这样有利于用户了解每个版本的维护情况，并及时了解当前所用的版本是否过时，或是否可能出现不兼容的情况。</p><p>首先修改顶层 CMakeLists 文件，在 <code>project</code> 命令之后加入如下两行：</p><div class="highlight"><pre><code class="language-text">set (Demo_VERSION_MAJOR 1)
set (Demo_VERSION_MINOR 0)</code></pre></div><p>分别指定当前的项目的主版本号和副版本号。</p><p>之后，为了在代码中获取版本信息，我们可以修改<a href="https://link.zhihu.com/?target=http%3A//config.h.in" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">config.h.in</span><span class="invisible"></span></a>文件，添加两个预定义变量：</p><div class="highlight"><pre><code class="language-text">// the configured options and settings for Tutorial
#define Demo_VERSION_MAJOR @Demo_VERSION_MAJOR@
#define Demo_VERSION_MINOR @Demo_VERSION_MINOR@</code></pre></div><p>这样就可以直接在代码中打印版本信息了：</p><div class="highlight"><pre><code class="language-text">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;math.h&gt;
#include "config.h"
#include "math/MathFunctions.h"

int main(int argc, char *argv[])
{
    if (argc &lt; 3){
        // print version info
        printf("%s Version %d.%d\n",
            argv[0],
            Demo_VERSION_MAJOR,
            Demo_VERSION_MINOR);
        printf("Usage: %s base exponent \n", argv[0]);
        return 1;
    }
    double base = atof(argv[1]);
    int exponent = atoi(argv[2]);
    
#if defined (HAVE_POW)
    printf("Now we use the standard library. \n");
    double result = pow(base, exponent);
#else
    printf("Now we use our own Math library. \n");
    double result = power(base, exponent);
#endif
    
    printf("%g ^ %d is %g\n", base, exponent, result);
    return 0;
}</code></pre></div><h3>生成安装包</h3><p>(源代码所在目录Demo8)</p><p>本节将学习如何配置生成各种平台上的安装包，包括二进制安装包和源码安装包。为了完成这个任务，我们需要用到 CPack ，它同样也是由 CMake 提供的一个工具，专门用于打包。</p><p>首先在顶层的 CMakeLists.txt 文件尾部添加下面几行：</p><div class="highlight"><pre><code class="language-text"># 构建一个 CPack 安装包
include (InstallRequiredSystemLibraries)
set (CPACK_RESOURCE_FILE_LICENSE
  "${CMAKE_CURRENT_SOURCE_DIR}/License.txt")
set (CPACK_PACKAGE_VERSION_MAJOR "${Demo_VERSION_MAJOR}")
set (CPACK_PACKAGE_VERSION_MINOR "${Demo_VERSION_MINOR}")
include (CPack)</code></pre></div><p>上面的代码做了以下几个工作：</p><ol><li>导入 InstallRequiredSystemLibraries 模块，以便之后导入 CPack 模块；</li><li>设置一些 CPack 相关变量，包括版权信息和版本信息，其中版本信息用了上一节定义的版本号；</li><li>导入 CPack 模块。</li></ol><p>接下来的工作是像往常一样构建工程，并执行 <code>cpack</code> 命令。</p><ul><li>生成二进制安装包：</li></ul><div class="highlight"><pre><code class="language-text">cpack -C CPackConfig.cmake</code></pre></div><ul><li>生成源码安装包</li></ul><div class="highlight"><pre><code class="language-text">cpack -C CPackSourceConfig.cmake</code></pre></div><p>我们可以试一下。在生成项目后，执行<code>cpack -C CPackConfig.cmake</code>命令：</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo8]$ cpack -C CPackSourceConfig.cmake
CPack: Create package using STGZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.sh generated.
CPack: Create package using TGZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.gz generated.
CPack: Create package using TZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.Z generated.</code></pre></div><p>此时会在该目录下创建 3 个不同格式的二进制包文件：</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo8]$ ls Demo8-*
Demo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z</code></pre></div><p>这 3 个二进制包文件所包含的内容是完全相同的。我们可以执行其中一个。此时会出现一个由 CPack 自动生成的交互式安装界面：</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo8]$ sh Demo8-1.0.1-Linux.sh 
Demo8 Installer Version: 1.0.1, Copyright (c) Humanity
This is a self-extracting archive.
The archive will be extracted to: /home/ehome/Documents/programming/C/power/Demo8

If you want to stop extracting, please press &lt;ctrl-C&gt;.
The MIT License (MIT)

Copyright (c) 2013 Joseph Pan(http://hahack.com)

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


Do you accept the license? [yN]: 
y
By default the Demo8 will be installed in:
  "/home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux"
Do you want to include the subdirectory Demo8-1.0.1-Linux?
Saying no will install in: "/home/ehome/Documents/programming/C/power/Demo8" [Yn]: 
y

Using target directory: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux
Extracting, please wait...

Unpacking finished successfully</code></pre></div><p>完成后提示安装到了 Demo8-1.0.1-Linux 子目录中，我们可以进去执行该程序：</p><div class="highlight"><pre><code class="language-text">[ehome@xman Demo8]$ ./Demo8-1.0.1-Linux/bin/Demo 5 2
Now we use our own Math library. 
5 ^ 2 is 25</code></pre></div><h3>参考链接</h3><a target="_blank" href="https://link.zhihu.com/?target=https%3A//www.hahack.com/codes/cmake/" data-draft-node="block" data-draft-type="link-card" class="LinkCard LinkCard--noImage"><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">https://www.hahack.com/codes/cmake/</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span>www.hahack.com</span></span><span class="LinkCard-imageCell"><div class="LinkCard-image LinkCard-image--default"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Browser" fill="currentColor" viewBox="0 0 24 24" width="32" height="32"><path d="M11.991 3C7.023 3 3 7.032 3 12s4.023 9 8.991 9C16.968 21 21 16.968 21 12s-4.032-9-9.009-9zm6.237 5.4h-2.655a14.084 14.084 0 0 0-1.242-3.204A7.227 7.227 0 0 1 18.228 8.4zM12 4.836A12.678 12.678 0 0 1 13.719 8.4h-3.438A12.678 12.678 0 0 1 12 4.836zM5.034 13.8A7.418 7.418 0 0 1 4.8 12c0-.621.09-1.224.234-1.8h3.042A14.864 14.864 0 0 0 7.95 12c0 .612.054 1.206.126 1.8H5.034zm.738 1.8h2.655a14.084 14.084 0 0 0 1.242 3.204A7.188 7.188 0 0 1 5.772 15.6zm2.655-7.2H5.772a7.188 7.188 0 0 1 3.897-3.204c-.54.999-.954 2.079-1.242 3.204zM12 19.164a12.678 12.678 0 0 1-1.719-3.564h3.438A12.678 12.678 0 0 1 12 19.164zm2.106-5.364H9.894A13.242 13.242 0 0 1 9.75 12c0-.612.063-1.215.144-1.8h4.212c.081.585.144 1.188.144 1.8 0 .612-.063 1.206-.144 1.8zm.225 5.004c.54-.999.954-2.079 1.242-3.204h2.655a7.227 7.227 0 0 1-3.897 3.204zm1.593-5.004c.072-.594.126-1.188.126-1.8 0-.612-.054-1.206-.126-1.8h3.042c.144.576.234 1.179.234 1.8s-.09 1.224-.234 1.8h-3.042z"/></svg></div></span></span></a><a target="_blank" href="https://link.zhihu.com/?target=https%3A//blog.csdn.net/afei__/article/details/81201039" data-draft-node="block" data-draft-type="link-card" data-image="https://pic3.zhimg.com/v2-7b32533d2a0ad6337c2915fb377882d2_180x120.jpg" data-image-width="496" data-image-height="164" class="LinkCard LinkCard--hasImage"><span class="LinkCard-backdrop" style="background-image:url(https://pic3.zhimg.com/v2-7b32533d2a0ad6337c2915fb377882d2_180x120.jpg)"></span><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">CMakeLists.txt 语法介绍与实例演练</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span>blog.csdn.net</span></span><span class="LinkCard-imageCell"><img class="LinkCard-image LinkCard-image--horizontal" alt="图标" src="https://pic3.zhimg.com/v2-7b32533d2a0ad6337c2915fb377882d2_180x120.jpg" /></span></span></a><p></p></div></div><div class="ContentItem-time">编辑于 2020-10-23</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19834837&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19834837" target="_blank"><div class="Popover"><div id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content">CMake</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19601705&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19601705" target="_blank"><div class="Popover"><div id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content">C / C++</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19640829&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19640829" target="_blank"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content">Makefile</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 929px; bottom: 0px; left: 155px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;267803605&quot;}}}"><span><button aria-label="赞同 52 " type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z" fill-rule="evenodd"/></svg></span>赞同 52</button><button aria-label="反对" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--TriangleDown" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z" fill-rule="evenodd"/></svg></span></button></span><div class="css-qbubgm"><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"/></svg></span>添加评论</button></div><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"/></svg></span>分享</button></div></div><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Heart Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2 8.437C2 5.505 4.294 3.094 7.207 3 9.243 3 11.092 4.19 12 6c.823-1.758 2.649-3 4.651-3C19.545 3 22 5.507 22 8.432 22 16.24 13.842 21 12 21 10.158 21 2 16.24 2 8.437z" fill-rule="evenodd"/></svg></span>喜欢</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Star Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z" fill-rule="evenodd"/></svg></span>收藏</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Dots Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill-rule="evenodd"/></svg></span></button></div></div></div></div></div><div class="Sticky--holder" style="position: static; inset: auto auto 0px 0px; display: block; float: none; margin: 0px 0px 10px; height: 54px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div class="Recommendations-Main" style="width: 1000px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--ArrowLeft" fill="#d3d3d3" viewBox="0 0 24 24" width="40" height="40"><path d="M14.782 16.78a.737.737 0 0 1-1.052 0L9.218 12.53a.758.758 0 0 1 0-1.063L13.73 7.22a.737.737 0 0 1 1.052 0c.29.294.29.77.001 1.063L11 12l3.782 3.716c.29.294.29.77 0 1.063z" fill-rule="evenodd"/></svg></button><a href="https://zhuanlan.zhihu.com/p/150869814" class="PostItem"><div><h1 class="PostItem-Title">cmake学习总结（一）</h1><p class="PostItem-Summary">大家晚上好，在这里祝大家端午安康。今天给大家分享的是工程管理工具cmake，没有先介绍makefile工程管理工具（坦白来说，这两者都差不多，cmake最终还是会生成Makefile的，只是说cmake语法…</p><div class="PostItem-Footer"><span>txp玩Linux</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/97369704" class="PostItem"><div><img src="https://pic1.zhimg.com/v2-30b6cce56e933a68a130f8f4f47edfa3_250x0.jpg?source=172ae18b" srcset="https://pic1.zhimg.com/v2-30b6cce56e933a68a130f8f4f47edfa3_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="Cmake之深入理解find_package()的用法" /><h1 class="PostItem-Title">Cmake之深入理解find_package()的用法</h1><div class="PostItem-Footer"><span>希葛格的韩少君</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/149337776" class="PostItem"><div><h1 class="PostItem-Title">一知半解学 CMake</h1><p class="PostItem-Summary">0 了解CMake很多知识需要记录才容易消化，所以记了这个笔记。内容基本为摘抄整理网络资源，后文会列出链接，因时间跨度较长未能罗列者，请见谅。 为何用Cmake？在linux环境编写程序，因没有…</p><div class="PostItem-Footer"><span>lochi...</span><span class="PostItem-FooterTitle">发表于Ubunt...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/85100123" class="PostItem"><div><h1 class="PostItem-Title">CMake 的研究与学习笔记</h1><p class="PostItem-Summary">cmake是一个跨平台项目生成工具，他根据不同的平台从源代码中生成相应的项目工程，可以生成包括makefile，vs等项目文件。 CMake的使用以生成makefile为例 cmake dir : 将在dir中寻找CMakeLi…</p><div class="PostItem-Footer"><span>Rayxuln</span><span class="PostItem-FooterTitle"></span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--ArrowRight" fill="#d3d3d3" viewBox="0 0 24 24" width="40" height="40"><path d="M9.218 16.78a.737.737 0 0 0 1.052 0l4.512-4.249a.758.758 0 0 0 0-1.063L10.27 7.22a.737.737 0 0 0-1.052 0 .759.759 0 0 0-.001 1.063L13 12l-3.782 3.716a.758.758 0 0 0 0 1.063z" fill-rule="evenodd"/></svg></button></ul></div><div class="Comments-container" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="CommentsV2 CommentsV2--withEditor CommentsV2-withPagination"><div class="Topbar CommentTopbar"><div class="Topbar-title"><h2 class="CommentTopbar-title">还没有评论</h2></div><div class="Topbar-options"></div></div><div><div class="CommentsV2-footer CommentEditorV2--normal"><div class="CommentEditorV2-inputWrap"><div class="InputLike CommentEditorV2-input Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-api73" style="white-space: pre-wrap;">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-api73" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="api73" data-offset-key="apudm-0-0"><div data-offset-key="apudm-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="apudm-0-0"><br data-text="true" /></span></div></div></div></div></div></div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;" /><div></div></div><div class="CommentEditorV2-inputUpload"><div class="CommentEditorV2-popoverWrap"><div class="Popover CommentEditorV2-inputUpLoad-Icon"><button aria-label="插入表情" data-tooltip="插入表情" data-tooltip-position="bottom" data-tooltip-will-hide-on-click="true" id="Popover6-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover6-content" type="button" class="Button Editable-control Button--plain"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Emotion" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M7.523 13.5h8.954c-.228 2.47-2.145 4-4.477 4-2.332 0-4.25-1.53-4.477-4zM12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1.5a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zm-3-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/></svg></button></div></div></div></div><button type="button" disabled="" class="Button CommentEditorV2-singleButton Button--primary Button--blue">发布</button></div></div><div><div class="CommentListV2"></div></div></div></div></div></div></main><div class="CornerButtons"><div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain"><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--BackToTop" aria-label="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"/></svg></button></div></div></div></div><script id="js-clientConfig" type="text/json">{"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com"}}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false}},"club":{"tags":{},"admins":{"data":[]},"members":{"data":[]},"explore":{"candidateSyncClubs":{}},"profile":{},"checkin":{},"comments":{"paging":{},"loading":{},"meta":{},"ids":{}},"postList":{"paging":{},"loading":{},"ids":{}},"recommend":{"data":[]},"silences":{"data":[]},"application":{"profile":null}},"entities":{"users":{"hero-ljy":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-7d70060712bf9751c10b034a8580b35b.jpg?source=172ae18b","uid":"852158096750026752","userType":"people","isFollowing":false,"urlToken":"hero-ljy","id":"021c66584e66da16279bd3ca380cf2d5","description":"一个理想高远、信念坚定的社会主义接班人","name":"Hero","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F021c66584e66da16279bd3ca380cf2d5","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-7d70060712bf9751c10b034a8580b35b_l.jpg?source=172ae18b","isOrg":false,"type":"people","vipInfo":{"isVip":true,"vipIcon":{"url":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4812630bc27d642f7cafcd6cdeca3d7a_r.png?source=172ae18b","nightModeUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c9686ff064ea3579730756ac6c289978_r.png?source=172ae18b"}},"levelInfo":{"exp":134319,"level":7,"nicknameColor":{"color":"","nightModeColor":""},"levelIcon":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-925f3f81dab3105fd42b785305a1cc28_l.png","iconInfo":{"url":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-925f3f81dab3105fd42b785305a1cc28_l.png","nightModeUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-4e20c1d51a61ffb91eebdc40e420e382_l.png","width":93,"height":51}},"badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"1124316222665379841","medalName":"我的知乎 2019","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-2592b0b52e1fac99f69b38e00252413b_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-ad363cc3088dc8de7544fd08b1c4987a_l.png?source=172ae18b","description":"参与「我的知乎 2019」即可获得"}}},"questions":{},"answers":{},"articles":{"267803605":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fpage_monitor_log?si=__SESSIONID__&amp;ti=__ATOKEN__&amp;at=view&amp;pf=__OS__&amp;ed=__MEMBERID__&amp;idfa=__IDFA__&amp;imei=__IMEI__&amp;androidid=__ANDROIDID__&amp;oaid=__OAID__&amp;ci=__CREATIVEID__&amp;zid=__ZONEID__"],"id":267803605,"title":"Cmake 语法与实战入门","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F267803605","imageUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c74a1f140a89f867b10081e9524139b5_720w.jpg?source=172ae18b","titleImage":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c74a1f140a89f867b10081e9524139b5_720w.jpg?source=172ae18b","excerpt":"CMakeCMake 是一个跨平台、开源的构建系统。它是一个集软件构建、测试、打包于一身的软件。它使用与平台和编译器独立的配置文件来对软件编译过程进行控制。 现如今，有各种各样的 Make 工具遵循着不同的规范和标准，所执行的 Makefile 格式也千差万别。这样…","created":1603367151,"updated":1603383531,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-7d70060712bf9751c10b034a8580b35b.jpg?source=172ae18b","uid":"852158096750026752","userType":"people","isFollowing":false,"urlToken":"hero-ljy","id":"021c66584e66da16279bd3ca380cf2d5","description":"一个理想高远、信念坚定的社会主义接班人","name":"Hero","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F021c66584e66da16279bd3ca380cf2d5","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-7d70060712bf9751c10b034a8580b35b_l.jpg?source=172ae18b","isOrg":false,"type":"people","vipInfo":{"isVip":true,"vipIcon":{"url":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4812630bc27d642f7cafcd6cdeca3d7a_r.png?source=172ae18b","nightModeUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c9686ff064ea3579730756ac6c289978_r.png?source=172ae18b"}},"levelInfo":{"exp":134319,"level":7,"nicknameColor":{"color":"","nightModeColor":""},"levelIcon":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-925f3f81dab3105fd42b785305a1cc28_l.png","iconInfo":{"url":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-925f3f81dab3105fd42b785305a1cc28_l.png","nightModeUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-4e20c1d51a61ffb91eebdc40e420e382_l.png","width":93,"height":51}},"badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"1124316222665379841","medalName":"我的知乎 2019","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-2592b0b52e1fac99f69b38e00252413b_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-ad363cc3088dc8de7544fd08b1c4987a_l.png?source=172ae18b","description":"参与「我的知乎 2019」即可获得"}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","imageWidth":620,"imageHeight":204,"content":"\u003Ch3\u003ECMake\u003C\u002Fh3\u003E\u003Cp\u003ECMake 是一个跨平台、开源的构建系统。它是一个集软件构建、测试、打包于一身的软件。它使用与平台和编译器独立的配置文件来对软件编译过程进行控制。\u003C\u002Fp\u003E\u003Cp\u003E现如今，有各种各样的 Make 工具遵循着不同的规范和标准，所执行的 Makefile 格式也千差万别。这样就带来了一个严峻的问题：如果软件想跨平台，必须要保证能够在不同平台编译。针对每一种Make工具写一遍Makefile显然非常浪费时间。\u003C\u002Fp\u003E\u003Cp\u003ECMake 就是针对上面问题所设计的工具：首先，它允许开发者编写一种平台无关的 CMakeList.txt 文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 Makefile 和工程文件。\u003C\u002Fp\u003E\u003Cp\u003E在 linux 平台下使用 CMake 生成 Makefile 并编译的流程如下：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E编写 CMake 配置文件 CMakeLists.txt 。\u003C\u002Fli\u003E\u003Cli\u003E执行命令 \u003Ccode\u003Ecmake PATH\u003C\u002Fcode\u003E 或者 \u003Ccode\u003Eccmake PATH\u003C\u002Fcode\u003E 生成 Makefile（\u003Ccode\u003Eccmake\u003C\u002Fcode\u003E 和 \u003Ccode\u003Ecmake\u003C\u002Fcode\u003E 的区别在于前者提供了一个交互式的界面）。其中， \u003Ccode\u003EPATH\u003C\u002Fcode\u003E 是 CMakeLists.txt 所在的目录。\u003C\u002Fli\u003E\u003Cli\u003E使用 \u003Ccode\u003Emake\u003C\u002Fcode\u003E 命令进行编译。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Ch3\u003E语法\u003C\u002Fh3\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E指定cmake最小版本\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp-objdump\"\u003Ecmake_minimum_required(VERSION 3.4.1)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在有些情况下，如果 CMakeLists.txt 文件中使用了一些高版本 cmake 特有的一些命令的时候，就需要加上这样一行，提醒用户升级到该版本之后再执行 cmake。\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E设置项目名称\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eproject(demo)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E最好写上，它会引入两个变量 demo_BINARY_DIR 和 demo_SOURCE_DIR，同时，cmake 自动定义了两个等价的变量 PROJECT_BINARY_DIR 和 PROJECT_SOURCE_DIR。\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E设置编译类型\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eadd_executable(demo demo.cpp) # 生成可执行文件\nadd_library(common STATIC util.cpp) # 生成静态库\nadd_library(common SHARED util.cpp) # 生成动态库或共享库\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003Eadd_library 默认生成是静态库，通过以上命令生成文件名字，\u003C\u002Fp\u003E\u003Cp\u003E在 Linux 下是：demo  libcommon.a  libcommon.so\u003C\u002Fp\u003E\u003Cp\u003E在 Windows 下是：demo.exe  common.lib  common.dll\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E指定编译包含的源文件 \u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Col\u003E\u003Cli\u003E明确指出包含哪些源文件\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eadd_library(demo demo.cpp test.cpp util.cpp)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E2. 搜索所有的cpp文件\u003C\u002Fp\u003E\u003Cp\u003Eaux_source_directory(dir VAR) 发现一个目录(dir)下所有的源代码文件并将列表存储在一个变量(VAR)中。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp-objdump\"\u003Eaux_source_directory(. SRC_LIST) # 搜索当前目录下的所有.cpp文件\nadd_library(demo ${SRC_LIST})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E3. 自定义搜索规则\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Efile(GLOB SRC_LIST &amp;#34;*.cpp&amp;#34; &amp;#34;protocol\u002F*.cpp&amp;#34;)\nadd_library(demo ${SRC_LIST})\n# 或者\nfile(GLOB SRC_LIST &amp;#34;*.cpp&amp;#34;)\nfile(GLOB SRC_PROTOCOL_LIST &amp;#34;protocol\u002F*.cpp&amp;#34;)\nadd_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})\n# 或者\naux_source_directory(. SRC_LIST)\naux_source_directory(protocol SRC_PROTOCOL_LIST)\nadd_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E查找指定的库文件\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003Efind_library(VAR name path)查找到指定的预编译库，并将它的路径存储在变量中。\u003Cbr\u002F\u003E默认的搜索路径为 cmake 包含的系统库，因此如果是 NDK 的公共库只需要指定库的name 即可（不需path）。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Efind_library(log-lib,log)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E类似的命令还有 find_file()、find_path()、find_program()、find_package()。\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E设置包含的目录\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Einclude_directories(\n    ${CMAKE_CURRENT_SOURCE_DIR}\n    ${CMAKE_CURRENT_BINARY_DIR}\n    ${CMAKE_CURRENT_SOURCE_DIR}\u002Finclude\n)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E设置target需要链接的库\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Etarget_link_libraries( # 目标库 demo # 目标库需要链接的库 ${log-lib} )\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在 Windows 下，系统会根据链接库目录，搜索xxx.lib 文件，Linux 下会搜索 xxx.so 或者 xxx.a 文件，如果都存在会优先链接动态库（so 后缀）。\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E指定链接动态库或静态库\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Etarget_link_libraries(demo libface.a) # 链接libface.a\ntarget_link_libraries(demo libface.so) # 链接libface.so\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E2. 指定全路径\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Etarget_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}\u002Flibs\u002Flibface.a)\ntarget_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}\u002Flibs\u002Flibface.so)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E3. 指定链接多个库\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Etarget_link_libraries(demo\n    ${CMAKE_CURRENT_SOURCE_DIR}\u002Flibs\u002Flibface.a\n    boost_system.a\n    boost_thread\n    pthread)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E设置变量\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Col\u003E\u003Cli\u003Eset 直接设置变量的值\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eset(SRC_LIST main.cpp test.cpp)\nadd_executable(demo ${SRC_LIST})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E2. set 追加设置变量的值\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eset(SRC_LIST main.cpp)\nset(SRC_LIST ${SRC_LIST} test.cpp)\nadd_executable(demo ${SRC_LIST})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\u003Cli\u003E\u003Cb\u003E常用变量\u003C\u002Fb\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EPROJECT_SOURCE_DIR：工程的根目录\u003C\u002Fp\u003E\u003Cp\u003EPROJECT_BINARY_DIR：运行cmake命令的目录，通常为${PROJECT_SOURCE_DIR}\u002Fbuild\u003C\u002Fp\u003E\u003Cp\u003EPROJECT_NAME：返回通过 project 命令定义的项目名称\u003C\u002Fp\u003E\u003Cp\u003ECMAKE_CURRENT_SOURCE_DIR：当前处理的 CMakeLists.txt 所在的路径\u003C\u002Fp\u003E\u003Cp\u003ECMAKE_CURRENT_BINARY_DIR：target 编译目录\u003C\u002Fp\u003E\u003Cp\u003ECMAKE_CURRENT_LIST_DIR：CMakeLists.txt 的完整路径\u003C\u002Fp\u003E\u003Cp\u003EEXECUTABLE_OUTPUT_PATH：重新定义目标二进制可执行文件的存放位置\u003C\u002Fp\u003E\u003Cp\u003ELIBRARY_OUTPUT_PATH：重新定义目标链接库文件的存放位置\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Ch3\u003E实战\u003C\u002Fh3\u003E\u003Ch3\u003E单个源文件\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录：Demo1)\u003C\u002Fp\u003E\u003Cp\u003E假设现在我们的项目中只有一个源文件\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fmain.cc\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Emain.cc\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，该程序的用途是计算一个数的指数幂。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E#include &amp;lt;stdio.h&amp;gt;\n#include &amp;lt;stdlib.h&amp;gt;\n\n\u002F**\n * power - Calculate the power of number.\n * @param base: Base value.\n * @param exponent: Exponent value.\n *\n * @return base raised to the power exponent.\n *\u002F\ndouble power(double base, int exponent)\n{\n    int result = base;\n    int i;\n\n    if (exponent == 0) {\n        return 1;\n    }\n    \n    for(i = 1; i &amp;lt; exponent; ++i){\n        result = result * base;\n    }\n\n    return result;\n}\n\nint main(int argc, char *argv[])\n{\n    if (argc &amp;lt; 3){\n        printf(&amp;#34;Usage: %s base exponent \\n&amp;#34;, argv[0]);\n        return 1;\n    }\n    double base = atof(argv[1]);\n    int exponent = atoi(argv[2]);\n    double result = power(base, exponent);\n    printf(&amp;#34;%g ^ %d is %g\\n&amp;#34;, base, exponent, result);\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E首先编写 CMakeLists.txt 文件，并保存在与\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fmian.cc\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Emian.cc\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E源文件同个目录下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# CMake 最低版本号要求\ncmake_minimum_required (VERSION 2.8)\n\n# 项目信息\nproject (Demo1)\n\n# 指定生成目标\nadd_executable(Demo main.cc)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003ECMakeLists.txt 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。符号 \u003Ccode\u003E#\u003C\u002Fcode\u003E 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。\u003C\u002Fp\u003E\u003Cp\u003E对于上面的 CMakeLists.txt 文件，依次出现了几个命令：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Ccode\u003Ecmake_minimum_required\u003C\u002Fcode\u003E：指定运行此配置文件所需的 CMake 的最低版本；\u003C\u002Fli\u003E\u003Cli\u003E\u003Ccode\u003Eproject\u003C\u002Fcode\u003E：参数值是 \u003Ccode\u003EDemo1\u003C\u002Fcode\u003E，该命令表示项目的名称是 \u003Ccode\u003EDemo1\u003C\u002Fcode\u003E 。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ccode\u003Eadd_executable\u003C\u002Fcode\u003E： 将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E之后，在当前目录执行\u003Ccode\u003Ecmake .\u003C\u002Fcode\u003E，得到 Makefile 后再使用\u003Ccode\u003Emake\u003C\u002Fcode\u003E命令编译得到 Demo1 可执行文件。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo1]$ cmake .\n-- The C compiler identification is GNU 4.8.2\n-- The CXX compiler identification is GNU 4.8.2\n-- Check for working C compiler: \u002Fusr\u002Fsbin\u002Fcc\n-- Check for working C compiler: \u002Fusr\u002Fsbin\u002Fcc -- works\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - done\n-- Check for working CXX compiler: \u002Fusr\u002Fsbin\u002Fc++\n-- Check for working CXX compiler: \u002Fusr\u002Fsbin\u002Fc++ -- works\n-- Detecting CXX compiler ABI info\n-- Detecting CXX compiler ABI info - done\n-- Configuring done\n-- Generating done\n-- Build files have been written to: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo1\n[ehome@xman Demo1]$ make\nScanning dependencies of target Demo\n[100%] Building C object CMakeFiles\u002FDemo.dir\u002Fmain.cc.o\nLinking C executable Demo\n[100%] Built target Demo\n[ehome@xman Demo1]$ .\u002FDemo 5 4\n5 ^ 4 is 625\n[ehome@xman Demo1]$ .\u002FDemo 7 3\n7 ^ 3 is 343\n[ehome@xman Demo1]$ .\u002FDemo 2 10\n2 ^ 10 is 1024\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E多个源文件\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo2)\u003C\u002Fp\u003E\u003Cp\u003E上面的例子只有单个源文件。现在假如把\u003Ccode\u003Epower\u003C\u002Fcode\u003E函数单独写进一个名为\u003Ccode\u003EMathFunctions.c\u003C\u002Fcode\u003E的源文件里，使得这个工程变成如下的形式：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002FDemo2\n    |\n    +--- main.cc\n    |\n    +--- MathFunctions.cc\n    |\n    +--- MathFunctions.h\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这个时候，CMakeLists.txt 可以改成如下的形式：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# CMake 最低版本号要求\ncmake_minimum_required (VERSION 2.8)\n\n# 项目信息\nproject (Demo2)\n\n# 指定生成目标\nadd_executable(Demo main.cc MathFunctions.cc)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E唯一的改动只是在\u003Ccode\u003Eadd_executable\u003C\u002Fcode\u003E命令中增加了一个\u003Ccode\u003EMathFunctions.cc\u003C\u002Fcode\u003E源文件。这样写当然没什么问题，但是如果源文件很多，把所有源文件的名字都加进去将是一件烦人的工作。更省事的方法是使用\u003Ccode\u003Eaux_source_directory\u003C\u002Fcode\u003E命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eaux_source_directory(&amp;lt;dir&amp;gt; &amp;lt;variable&amp;gt;)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E因此，可以修改 CMakeLists.txt 如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# CMake 最低版本号要求\ncmake_minimum_required (VERSION 2.8)\n\n# 项目信息\nproject (Demo2)\n\n# 查找当前目录下的所有源文件\n# 并将名称保存到 DIR_SRCS 变量\naux_source_directory(. DIR_SRCS)\n\n# 指定生成目标\nadd_executable(Demo ${DIR_SRCS})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这样，CMake 会将当前目录所有源文件的文件名赋值给变量\u003Ccode\u003EDIR_SRCS\u003C\u002Fcode\u003E，再指示变量\u003Ccode\u003EDIR_SRCS\u003C\u002Fcode\u003E中的源文件需要编译成一个名称为 Demo 的可执行文件。\u003C\u002Fp\u003E\u003Ch3\u003E多个目录，多个源文件\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo3)\u003C\u002Fp\u003E\u003Cp\u003E现在进一步将 MathFunctions.h 和\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002FMathFunctions.cc\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003EMathFunctions.cc\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E文件移动到 math 目录下。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E.\u002FDemo3\n    |\n    +--- main.cc\n    |\n    +--- math\u002F\n          |\n          +--- MathFunctions.cc\n          |\n          +--- MathFunctions.h\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E对于这种情况，需要分别在项目根目录 Demo3 和 math 目录里各编写一个 CMakeLists.txt 文件。为了方便，我们可以先将 math 目录里的文件编译成静态库再由 main 函数调用。\u003C\u002Fp\u003E\u003Cp\u003E根目录中的 CMakeLists.txt ：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# CMake 最低版本号要求\ncmake_minimum_required (VERSION 2.8)\n\n# 项目信息\nproject (Demo3)\n\n# 查找当前目录下的所有源文件\n# 并将名称保存到 DIR_SRCS 变量\naux_source_directory(. DIR_SRCS)\n\n# 添加 math 子目录\nadd_subdirectory(math)\n\n# 指定生成目标 \nadd_executable(Demo ${DIR_SRCS})\n\n# 添加链接库\ntarget_link_libraries(Demo MathFunctions)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E该文件添加了下面的内容: 第3行，使用命令 \u003Ccode\u003Eadd_subdirectory\u003C\u002Fcode\u003E 指明本项目包含一个子目录 math，这样 math 目录下的 CMakeLists.txt 文件和源代码也会被处理 。第6行，使用命令 \u003Ccode\u003Etarget_link_libraries\u003C\u002Fcode\u003E 指明可执行文件 main 需要连接一个名为 MathFunctions 的链接库 。\u003C\u002Fp\u003E\u003Cp\u003E子目录中的 CMakeLists.txt：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 查找当前目录下的所有源文件\n# 并将名称保存到 DIR_LIB_SRCS 变量\naux_source_directory(. DIR_LIB_SRCS)\n\n# 生成链接库\nadd_library (MathFunctions ${DIR_LIB_SRCS})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在该文件中使用命令\u003Ccode\u003Eadd_library\u003C\u002Fcode\u003E将 src 目录中的源文件编译为静态链接库。\u003C\u002Fp\u003E\u003Ch3\u003E自定义编译选项\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo4)\u003C\u002Fp\u003E\u003Cp\u003ECMake 允许为项目增加编译选项，从而可以根据用户的环境和需求选择最合适的编译方案。\u003C\u002Fp\u003E\u003Cp\u003E例如，可以将 MathFunctions 库设为一个可选的库，如果该选项为 \u003Ccode\u003EON\u003C\u002Fcode\u003E ，就使用该库定义的数学函数来进行运算。否则就调用标准库中的数学函数库。\u003C\u002Fp\u003E\u003Cp\u003E我们要做的第一步是在顶层的 CMakeLists.txt 文件中添加该选项：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# CMake 最低版本号要求\ncmake_minimum_required (VERSION 2.8)\n\n# 项目信息\nproject (Demo4)\n\n# 加入一个配置头文件，用于处理 CMake 对源码的设置\nconfigure_file (\n  &amp;#34;${PROJECT_SOURCE_DIR}\u002Fconfig.h.in&amp;#34;\n  &amp;#34;${PROJECT_BINARY_DIR}\u002Fconfig.h&amp;#34;\n  )\n\n# 是否使用自己的 MathFunctions 库\noption (USE_MYMATH\n       &amp;#34;Use provided math implementation&amp;#34; ON) # 设置为ON，或OFF\n\n# 是否加入 MathFunctions 库\nif (USE_MYMATH)\n  include_directories (&amp;#34;${PROJECT_SOURCE_DIR}\u002Fmath&amp;#34;)\n  add_subdirectory (math)  \n  set (EXTRA_LIBS ${EXTRA_LIBS} MathFunctions)\nendif (USE_MYMATH)\n\n# 查找当前目录下的所有源文件\n# 并将名称保存到 DIR_SRCS 变量\naux_source_directory(. DIR_SRCS)\n\n# 指定生成目标\nadd_executable(Demo ${DIR_SRCS})\ntarget_link_libraries (Demo  ${EXTRA_LIBS})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E其中：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E第7行的 \u003Ccode\u003Econfigure_file\u003C\u002Fcode\u003E 命令用于加入一个配置头文件 config.h ，这个文件由 CMake 从config.h.in 生成，通过这样的机制，将可以通过预定义一些参数和变量来控制代码的生成。\u003C\u002Fli\u003E\u003Cli\u003E第13行的 \u003Ccode\u003Eoption\u003C\u002Fcode\u003E 命令添加了一个 \u003Ccode\u003EUSE_MYMATH\u003C\u002Fcode\u003E 选项，并且默认值为 \u003Ccode\u003EON\u003C\u002Fcode\u003E 。\u003C\u002Fli\u003E\u003Cli\u003E第17行根据 \u003Ccode\u003EUSE_MYMATH\u003C\u002Fcode\u003E 变量的值来决定是否使用我们自己编写的 MathFunctions 库。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E之后，修改\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fmain.cc\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Emain.cc\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E文件，让其根据\u003Ccode\u003EUSE_MYMATH\u003C\u002Fcode\u003E的预定义值来决定是否调用标准库还是 MathFunctions 库：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E#include &amp;lt;stdio.h&amp;gt;\n#include &amp;lt;stdlib.h&amp;gt;\n#include &amp;#34;config.h&amp;#34;\n\n#ifdef USE_MYMATH\n  #include &amp;#34;math\u002FMathFunctions.h&amp;#34;\n#else\n  #include &amp;lt;math.h&amp;gt;\n#endif\n\n\nint main(int argc, char *argv[])\n{\n    if (argc &amp;lt; 3){\n        printf(&amp;#34;Usage: %s base exponent \\n&amp;#34;, argv[0]);\n        return 1;\n    }\n    double base = atof(argv[1]);\n    int exponent = atoi(argv[2]);\n    \n#ifdef USE_MYMATH\n    printf(&amp;#34;Now we use our own Math library. \\n&amp;#34;);\n    double result = power(base, exponent);\n#else\n    printf(&amp;#34;Now we use the standard library. \\n&amp;#34;);\n    double result = pow(base, exponent);\n#endif\n    printf(&amp;#34;%g ^ %d is %g\\n&amp;#34;, base, exponent, result);\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面的程序值得注意的是第2行，这里引用了一个 config.h 文件，这个文件预定义了\u003Ccode\u003EUSE_MYMATH\u003C\u002Fcode\u003E的值。但我们并不直接编写这个文件，为了方便从 CMakeLists.txt 中导入配置，我们编写一个config.h.in文件，内容如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E#cmakedefine USE_MYMATH\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这样 CMake 会自动根据 CMakeLists 配置文件中的设置自动生成 config.h 文件。\u003C\u002Fp\u003E\u003Cp\u003E为了便于交互式的选择该变量的值，可以使用\u003Ccode\u003Eccmake\u003C\u002Fcode\u003E命令（也可以使用\u003Ccode\u003Ecmake -i\u003C\u002Fcode\u003E命令，该命令会提供一个会话式的交互式配置界面）。\u003C\u002Fp\u003E\u003Ch3\u003E安装和测试\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo5)\u003C\u002Fp\u003E\u003Cp\u003E首先先在 math\u002FCMakeLists.txt 文件里添加下面两行：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 指定 MathFunctions 库的安装路径\ninstall (TARGETS MathFunctions DESTINATION bin)\ninstall (FILES MathFunctions.h DESTINATION include)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E指明 MathFunctions 库的安装路径。之后同样修改根目录的 CMakeLists 文件，在末尾添加下面几行：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 指定安装路径\ninstall (TARGETS Demo DESTINATION bin)\ninstall (FILES &amp;#34;${PROJECT_BINARY_DIR}\u002Fconfig.h&amp;#34;\n         DESTINATION include)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E通过上面的定制，生成的 Demo 文件和 MathFunctions 函数库 libMathFunctions.o 文件将会被复制到\u003Ccode\u003E\u002Fusr\u002Flocal\u002Fbin\u003C\u002Fcode\u003E中，而 MathFunctions.h 和生成的 config.h 文件则会被复制到\u003Ccode\u003E\u002Fusr\u002Flocal\u002Finclude\u003C\u002Fcode\u003E中。我们可以验证一下（顺带一提的是，这里的\u003Ccode\u003E\u002Fusr\u002Flocal\u002F\u003C\u002Fcode\u003E是默认安装到的根目录，可以通过修改\u003Ccode\u003ECMAKE_INSTALL_PREFIX\u003C\u002Fcode\u003E变量的值来指定这些文件应该拷贝到哪个根目录）：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo5]$ sudo make install\n[ 50%] Built target MathFunctions\n[100%] Built target Demo\nInstall the project...\n-- Install configuration: &amp;#34;&amp;#34;\n-- Installing: \u002Fusr\u002Flocal\u002Fbin\u002FDemo\n-- Installing: \u002Fusr\u002Flocal\u002Finclude\u002Fconfig.h\n-- Installing: \u002Fusr\u002Flocal\u002Fbin\u002FlibMathFunctions.a\n-- Up-to-date: \u002Fusr\u002Flocal\u002Finclude\u002FMathFunctions.h\n[ehome@xman Demo5]$ ls \u002Fusr\u002Flocal\u002Fbin\nDemo  libMathFunctions.a\n[ehome@xman Demo5]$ ls \u002Fusr\u002Flocal\u002Finclude\nconfig.h  MathFunctions.h\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E添加测试同样很简单。CMake 提供了一个称为 CTest 的测试工具。我们要做的只是在项目根目录的 CMakeLists 文件中调用一系列的\u003Ccode\u003Eadd_test\u003C\u002Fcode\u003E命令。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 启用测试\nenable_testing()\n\n# 测试程序是否成功运行\nadd_test (test_run Demo 5 2)\n\n# 测试帮助信息是否可以正常提示\nadd_test (test_usage Demo)\nset_tests_properties (test_usage\n  PROPERTIES PASS_REGULAR_EXPRESSION &amp;#34;Usage: .* base exponent&amp;#34;)\n\n# 测试 5 的平方\nadd_test (test_5_2 Demo 5 2)\n\nset_tests_properties (test_5_2\n PROPERTIES PASS_REGULAR_EXPRESSION &amp;#34;is 25&amp;#34;)\n\n# 测试 10 的 5 次方\nadd_test (test_10_5 Demo 10 5)\n\nset_tests_properties (test_10_5\n PROPERTIES PASS_REGULAR_EXPRESSION &amp;#34;is 100000&amp;#34;)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面的代码包含了三个测试。第一个测试\u003Ccode\u003Etest_run\u003C\u002Fcode\u003E用来测试程序是否成功运行并返回 0 值。剩下的两个测试分别用来测试 5 的 平方、10 的 5 次方是否都能得到正确的结果。其中\u003Ccode\u003EPASS_REGULAR_EXPRESSION\u003C\u002Fcode\u003E用来测试输出是否包含后面跟着的字符串。\u003C\u002Fp\u003E\u003Cp\u003E如果要测试更多的输入数据，像上面那样一个个写测试用例未免太繁琐。这时可以通过编写宏来实现：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 定义一个宏，用来简化测试工作\nmacro (do_test arg1 arg2 result)\n  add_test (test_${arg1}_${arg2} Demo ${arg1} ${arg2})\n  set_tests_properties (test_${arg1}_${arg2}\n    PROPERTIES PASS_REGULAR_EXPRESSION ${result})\nendmacro (do_test)\n \n# 使用该宏进行一系列的数据测试\ndo_test (5 2 &amp;#34;is 25&amp;#34;)\ndo_test (10 5 &amp;#34;is 100000&amp;#34;)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E支持gdb\u003C\u002Fh3\u003E\u003Cp\u003E让 CMake 支持 gdb 的设置也很容易，只需要指定\u003Ccode\u003EDebug\u003C\u002Fcode\u003E模式下开启\u003Ccode\u003E-g\u003C\u002Fcode\u003E选项：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eset(CMAKE_BUILD_TYPE &amp;#34;Debug&amp;#34;)\nset(CMAKE_CXX_FLAGS_DEBUG &amp;#34;$ENV{CXXFLAGS} -O0 -Wall -g -ggdb&amp;#34;)\nset(CMAKE_CXX_FLAGS_RELEASE &amp;#34;$ENV{CXXFLAGS} -O3 -Wall&amp;#34;)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E之后可以直接对生成的程序使用 gdb 来调试。\u003C\u002Fp\u003E\u003Ch3\u003E添加版本号\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo7)\u003C\u002Fp\u003E\u003Cp\u003E给项目添加和维护版本号是一个好习惯，这样有利于用户了解每个版本的维护情况，并及时了解当前所用的版本是否过时，或是否可能出现不兼容的情况。\u003C\u002Fp\u003E\u003Cp\u003E首先修改顶层 CMakeLists 文件，在 \u003Ccode\u003Eproject\u003C\u002Fcode\u003E 命令之后加入如下两行：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eset (Demo_VERSION_MAJOR 1)\nset (Demo_VERSION_MINOR 0)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E分别指定当前的项目的主版本号和副版本号。\u003C\u002Fp\u003E\u003Cp\u003E之后，为了在代码中获取版本信息，我们可以修改\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fconfig.h.in\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Econfig.h.in\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E文件，添加两个预定义变量：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F the configured options and settings for Tutorial\n#define Demo_VERSION_MAJOR @Demo_VERSION_MAJOR@\n#define Demo_VERSION_MINOR @Demo_VERSION_MINOR@\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这样就可以直接在代码中打印版本信息了：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E#include &amp;lt;stdio.h&amp;gt;\n#include &amp;lt;stdlib.h&amp;gt;\n#include &amp;lt;math.h&amp;gt;\n#include &amp;#34;config.h&amp;#34;\n#include &amp;#34;math\u002FMathFunctions.h&amp;#34;\n\nint main(int argc, char *argv[])\n{\n    if (argc &amp;lt; 3){\n        \u002F\u002F print version info\n        printf(&amp;#34;%s Version %d.%d\\n&amp;#34;,\n            argv[0],\n            Demo_VERSION_MAJOR,\n            Demo_VERSION_MINOR);\n        printf(&amp;#34;Usage: %s base exponent \\n&amp;#34;, argv[0]);\n        return 1;\n    }\n    double base = atof(argv[1]);\n    int exponent = atoi(argv[2]);\n    \n#if defined (HAVE_POW)\n    printf(&amp;#34;Now we use the standard library. \\n&amp;#34;);\n    double result = pow(base, exponent);\n#else\n    printf(&amp;#34;Now we use our own Math library. \\n&amp;#34;);\n    double result = power(base, exponent);\n#endif\n    \n    printf(&amp;#34;%g ^ %d is %g\\n&amp;#34;, base, exponent, result);\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E生成安装包\u003C\u002Fh3\u003E\u003Cp\u003E(源代码所在目录Demo8)\u003C\u002Fp\u003E\u003Cp\u003E本节将学习如何配置生成各种平台上的安装包，包括二进制安装包和源码安装包。为了完成这个任务，我们需要用到 CPack ，它同样也是由 CMake 提供的一个工具，专门用于打包。\u003C\u002Fp\u003E\u003Cp\u003E首先在顶层的 CMakeLists.txt 文件尾部添加下面几行：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E# 构建一个 CPack 安装包\ninclude (InstallRequiredSystemLibraries)\nset (CPACK_RESOURCE_FILE_LICENSE\n  &amp;#34;${CMAKE_CURRENT_SOURCE_DIR}\u002FLicense.txt&amp;#34;)\nset (CPACK_PACKAGE_VERSION_MAJOR &amp;#34;${Demo_VERSION_MAJOR}&amp;#34;)\nset (CPACK_PACKAGE_VERSION_MINOR &amp;#34;${Demo_VERSION_MINOR}&amp;#34;)\ninclude (CPack)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面的代码做了以下几个工作：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E导入 InstallRequiredSystemLibraries 模块，以便之后导入 CPack 模块；\u003C\u002Fli\u003E\u003Cli\u003E设置一些 CPack 相关变量，包括版权信息和版本信息，其中版本信息用了上一节定义的版本号；\u003C\u002Fli\u003E\u003Cli\u003E导入 CPack 模块。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E接下来的工作是像往常一样构建工程，并执行 \u003Ccode\u003Ecpack\u003C\u002Fcode\u003E 命令。\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E生成二进制安装包：\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ecpack -C CPackConfig.cmake\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\u003Cli\u003E生成源码安装包\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ecpack -C CPackSourceConfig.cmake\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E我们可以试一下。在生成项目后，执行\u003Ccode\u003Ecpack -C CPackConfig.cmake\u003C\u002Fcode\u003E命令：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo8]$ cpack -C CPackSourceConfig.cmake\nCPack: Create package using STGZ\nCPack: Install projects\nCPack: - Run preinstall target for: Demo8\nCPack: - Install project: Demo8\nCPack: Create package\nCPack: - package: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\u002FDemo8-1.0.1-Linux.sh generated.\nCPack: Create package using TGZ\nCPack: Install projects\nCPack: - Run preinstall target for: Demo8\nCPack: - Install project: Demo8\nCPack: Create package\nCPack: - package: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\u002FDemo8-1.0.1-Linux.tar.gz generated.\nCPack: Create package using TZ\nCPack: Install projects\nCPack: - Run preinstall target for: Demo8\nCPack: - Install project: Demo8\nCPack: Create package\nCPack: - package: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\u002FDemo8-1.0.1-Linux.tar.Z generated.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E此时会在该目录下创建 3 个不同格式的二进制包文件：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo8]$ ls Demo8-*\nDemo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这 3 个二进制包文件所包含的内容是完全相同的。我们可以执行其中一个。此时会出现一个由 CPack 自动生成的交互式安装界面：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo8]$ sh Demo8-1.0.1-Linux.sh \nDemo8 Installer Version: 1.0.1, Copyright (c) Humanity\nThis is a self-extracting archive.\nThe archive will be extracted to: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\n\nIf you want to stop extracting, please press &amp;lt;ctrl-C&amp;gt;.\nThe MIT License (MIT)\n\nCopyright (c) 2013 Joseph Pan(http:\u002F\u002Fhahack.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the &amp;#34;Software&amp;#34;), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and\u002For sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED &amp;#34;AS IS&amp;#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\nDo you accept the license? [yN]: \ny\nBy default the Demo8 will be installed in:\n  &amp;#34;\u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\u002FDemo8-1.0.1-Linux&amp;#34;\nDo you want to include the subdirectory Demo8-1.0.1-Linux?\nSaying no will install in: &amp;#34;\u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8&amp;#34; [Yn]: \ny\n\nUsing target directory: \u002Fhome\u002Fehome\u002FDocuments\u002Fprogramming\u002FC\u002Fpower\u002FDemo8\u002FDemo8-1.0.1-Linux\nExtracting, please wait...\n\nUnpacking finished successfully\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E完成后提示安装到了 Demo8-1.0.1-Linux 子目录中，我们可以进去执行该程序：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[ehome@xman Demo8]$ .\u002FDemo8-1.0.1-Linux\u002Fbin\u002FDemo 5 2\nNow we use our own Math library. \n5 ^ 2 is 25\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E参考链接\u003C\u002Fh3\u003E\u003Ca data-draft-node=\"block\" data-draft-type=\"link-card\" href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.hahack.com\u002Fcodes\u002Fcmake\u002F\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ehahack.com\u002Fcodes\u002Fcmake\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003Ca data-draft-node=\"block\" data-draft-type=\"link-card\" href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fblog.csdn.net\u002Fafei__\u002Farticle\u002Fdetails\u002F81201039\" data-image=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7b32533d2a0ad6337c2915fb377882d2_180x120.jpg\" data-image-width=\"496\" data-image-height=\"164\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ECMakeLists.txt 语法介绍与实例演练\u003C\u002Fa\u003E\u003Cp\u003E\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19834837","type":"topic","id":"19834837","name":"CMake"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19601705","type":"topic","id":"19601705","name":"C \u002F C++"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19640829","type":"topic","id":"19640829","name":"Makefile"}],"voteupCount":52,"voting":0,"commentCount":0,"contributions":[],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":false,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":103,"isNormal":true,"status":0,"shareText":"Cmake 语法与实战入门 - 来自知乎专栏，作者: Hero https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F267803605 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":16,"visibleOnlyToAuthor":false,"hasColumn":false,"republishers":[]}},"columns":{},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{}},"currentUser":"","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false}},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{}},"env":{"ab":{"config":{"experiments":[{"expId":"launch-qa_cl_guest-2","expPrefix":"qa_cl_guest","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_item-3","expPrefix":"se_item","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_andplay_d-2","expPrefix":"vd_andplay_d","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_hookupplay_an-2","expPrefix":"vd_hookupplay_an","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_timeguide-2","expPrefix":"vd_timeguide","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_video_replay-3","expPrefix":"vd_video_replay","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_zvideo_link-10","expPrefix":"vd_zvideo_link","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"zanswer-2","expPrefix":"zanswer","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"recnew_2th-3","expPrefix":"recnew_2th","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"captcha_v2-2_v11","expPrefix":"captcha_v2","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"Test_Punk-1_v2","expPrefix":"Test_Punk","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"meta_ebook-2_v1","expPrefix":"meta_ebook","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"club_fn-1_v4","expPrefix":"club_fn","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"webpImg-1_v3","expPrefix":"webpImg","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"general_1-2_v1","expPrefix":"general_1","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"correct_gpu-6_v5","expPrefix":"correct_gpu","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"correct_pos-4_v2","expPrefix":"correct_pos","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_cvr_boost-3_v1","expPrefix":"se_cvr_boost","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_doc_cnt-1_v6","expPrefix":"se_doc_cnt","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"rec_new2th-2_v3","expPrefix":"rec_new2th","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_zp_five-4_v1","expPrefix":"se_zp_five","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_cbert-3_v2","expPrefix":"se_cbert","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"hw_aa_30-1_v2","expPrefix":"hw_aa_30","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"hw_aa_50-1_v1","expPrefix":"hw_aa_50","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false}],"params":[{"id":"web_heifetz_grow_ad","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"zr_expslotpaid","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_11"},{"id":"ge_dipin_pre","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1000","key":3124},{"id":"ge_meta_ss","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_834","key":3079},{"id":"recnew_2th","type":"Int","value":"21","chainId":"_gene_","layerId":"recnew_2th","key":67},{"id":"se_prerank","type":"Int","value":"0","chainId":"_gene_","layerId":"6XUc","key":354},{"id":"tp_contents","type":"String","value":"2","chainId":"_all_","layerId":"tptp_layer_627"},{"id":"ge_prf_rec","type":"String","value":"0","chainId":"_gene_","layerId":"getop_layer_991","key":3040},{"id":"pf_adjust","type":"String","value":"0","chainId":"_all_","layerId":"pfus_layer_9"},{"id":"gue_andplayd","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"gue_bulletmb","type":"String","value":"0","layerId":"guevd_layer_812"},{"id":"pfd_newbie2","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie2","key":71},{"id":"zr_slotpaidexp","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_5"},{"id":"ge_newcard","type":"String","value":"3","chainId":"_gene_","layerId":"geus_layer_839","key":2997},{"id":"gue_zvideo_link","type":"String","value":"1","layerId":"guevd_layer_2"},{"id":"gue_video_replay","type":"String","value":"2","layerId":"guevd_layer_3"},{"id":"gue_v_serial","type":"String","value":"1","layerId":"guevd_layer_695"},{"id":"ge_rec_2th","type":"String","value":"11","chainId":"_gene_","layerId":"geli_layer_965","key":3023},{"id":"ge_item","type":"String","value":"2","chainId":"_gene_","layerId":"gese_layer_945","key":2971},{"id":"web_audit_01","type":"String","value":"case1","layerId":"webre_layer_1"},{"id":"se_ffzx_jushen1","type":"String","value":"0","chainId":"_all_","layerId":"sese_layer_4"},{"id":"gue_profile_video","type":"String","value":"1","layerId":"guevd_layer_5"},{"id":"gue_iosplay","type":"String","value":"0","layerId":"guevd_layer_896"},{"id":"gue_vid_tab","type":"String","value":"0","layerId":"guevd_layer_900"},{"id":"li_paid_answer_exp","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_3"},{"id":"gue_messrec","type":"String","value":"0","layerId":"gueqa_layer_769"},{"id":"web_sem_ab","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"qap_question_author","type":"String","value":"0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"web_answer_list_ad","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"se_fix_ebook","type":"Int","value":"0","chainId":"_gene_","layerId":"se_fix_ebook","key":103},{"id":"se_4a","type":"Int","value":"0","chainId":"_gene_","layerId":"rtiq","key":335},{"id":"top_test_4_liguangyi","type":"String","value":"1","chainId":"_all_","layerId":"iosus_layer_1"},{"id":"gue_bullet_guide","type":"String","value":"发个弹幕聊聊…","layerId":"guevd_layer_0"},{"id":"web_answerlist_ad","type":"String","value":"0","layerId":"webqa_layer_1"},{"id":"ge_sug_rep","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1034","key":3158},{"id":"se_cbert","type":"Int","value":"1","chainId":"_gene_","layerId":"qRp6","key":359},{"id":"hw_aa_50","type":"Int","value":"0","chainId":"_gene_","layerId":"hw_aa_50","key":362},{"id":"gue_repost","type":"String","value":"0","layerId":"gueqa_layer_671"},{"id":"ge_sxzx","type":"String","value":"0","chainId":"_gene_","layerId":"gere_layer_990","key":3060},{"id":"ge_guess","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_938","key":2912},{"id":"ge_newyanzhi","type":"String","value":"0","chainId":"_gene_","layerId":"geus_layer_1019","key":2788},{"id":"show_ad","type":"Int","value":"0","chainId":"_gene_","layerId":"show_ad","key":27},{"id":"pfd_newbie","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie","key":63},{"id":"gue_playh_an","type":"String","value":"1","layerId":"guevd_layer_622"},{"id":"se_doc_cnt","type":"Int","value":"0","chainId":"_gene_","layerId":"uD1x","key":302},{"id":"ge_emoji","type":"String","value":"0","chainId":"_gene_","layerId":"getp_layer_827","key":3209},{"id":"gue_goods_card","type":"String","value":"0","layerId":"gueqa_layer_1"},{"id":"gue_art_ui","type":"String","value":"0","layerId":"gueqa_layer_647"},{"id":"gue_q_share","type":"String","value":"0","layerId":"gueqa_layer_647"},{"id":"tp_dingyue_video","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"tp_zrec","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_619"},{"id":"hw_aa_30","type":"Int","value":"0","chainId":"_gene_","layerId":"hw_aa_30","key":361},{"id":"ge_video","type":"String","value":"0","chainId":"_gene_","layerId":"geli_layer_856","key":2831},{"id":"ge_hard_s_ma","type":"String","value":"0","chainId":"_gene_","layerId":"geli_layer_856","key":3031},{"id":"gue_recmess","type":"String","value":"0","layerId":"gueqa_layer_795"},{"id":"web_column_auto_invite","type":"String","value":"0","layerId":"webqa_layer_1"},{"id":"zanswer","type":"Int","value":"1","layerId":"zanswer"},{"id":"test_rec","type":"Int","value":"10","layerId":"test_rec"},{"id":"gue_card_test","type":"String","value":"1","layerId":"gueqa_layer_2"},{"id":"ge_usercard1","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_742","key":2740},{"id":"ge_infinity6","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_815","key":2817},{"id":"ge_relation2","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_815","key":2796},{"id":"ge_upload","type":"String","value":"0","chainId":"_gene_","layerId":"geus_layer_839","key":2892},{"id":"Test_Punk","type":"Int","value":"0","layerId":"Test_Punk"},{"id":"ge_newbie3","type":"Int","value":"0","chainId":"_gene_","layerId":"ge_newbie3","key":180},{"id":"li_edu_page","type":"String","value":"old","chainId":"_all_","layerId":"lili_layer_580"},{"id":"gue_cdzixun","type":"String","value":"0","layerId":"gueqa_layer_3"},{"id":"ge_v_rank_v3","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1047","key":2966},{"id":"ge_entity","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_946","key":3036},{"id":"gue_sharp","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"webpImg","type":"Int","value":"1","layerId":"JnVt"},{"id":"se_cvr_boost","type":"Int","value":"1","chainId":"_gene_","layerId":"se_cvr_boost","key":183},{"id":"general_1","type":"Int","value":"2","chainId":"_gene_","layerId":"general_1","key":8},{"id":"web_scl_rec","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"li_sp_mqbk","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_748"},{"id":"tp_topic_style","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"pf_noti_entry_num","type":"String","value":"0","chainId":"_all_","layerId":"pfus_layer_718"},{"id":"captcha_v2","type":"Int","value":"1","layerId":"captcha_v2"},{"id":"meta_ebook","type":"Int","value":"1","layerId":"meta_ebook"},{"id":"rec_new2th","type":"Int","value":"1","chainId":"_gene_","layerId":"Hump","key":320},{"id":"li_panswer_topic","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_602"},{"id":"gue_art2qa","type":"String","value":"0","layerId":"gueqa_layer_579"},{"id":"qap_question_visitor","type":"String","value":" 0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"web_collection_guest","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"ge_search_ui","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_838","key":2898},{"id":"club_fn","type":"Int","value":"1","layerId":"club_fn"},{"id":"ge_rec_sup","type":"Int","value":"0","chainId":"_gene_","layerId":"ge_rec_sup","key":197},{"id":"li_video_section","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_7"},{"id":"ge_sug_v2","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1000","key":3189},{"id":"ge_yuzhi_v1","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1029","key":3127},{"id":"correct_gpu","type":"Int","value":"5","chainId":"_gene_","layerId":"correct_gpu","key":66},{"id":"li_vip_verti_search","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_2"},{"id":"web_login","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"gue_visit_n_artcard","type":"String","value":"1","layerId":"gueqa_layer_579"},{"id":"gue_fo_recom","type":"String","value":"0","layerId":"gueqa_layer_780"},{"id":"gue_bullet_second","type":"String","value":"1","layerId":"guevd_layer_1"},{"id":"gue_video_guide","type":"String","value":"1","layerId":"guevd_layer_625"},{"id":"correct_pos","type":"Int","value":"2","chainId":"_gene_","layerId":"correct_pos","key":104},{"id":"se_zp_five","type":"Int","value":"1","chainId":"_gene_","layerId":"se_zp_five","key":344}],"chains":[{"chainId":"_all_"}],"encodedParams":"ClI0DAcMQwBiAeALRwC1C88LmwtnAE8BVgxnAWoB9AtgC+QKGwA\u002FAC4BiQxpAQ8L1wu0CgEL7ApMC7QAlgvcC7cACABAAVILxQB1DDcMQgBoAFgBEikAABUAAAADCwIAAAEBAAAAAAAAAAAAAAAAAAEAAAAAAQIBAQAAAQUCAQ=="},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F88.0.4324.104 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F267803605","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F267803605","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"miniProgram":false,"xiaomi":false},"theme":"light","enableShortcut":true,"referer":"","xUDId":"AFAQXjcaXRKPTs930p-q4FpMhtw-vZ1z-Go=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"珠海","countryName":"中国","regionName":"广东","countryCode":"CN"},"logged":false,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"active":{"sendDigitsError":null,"activeConfirmSucceeded":null,"activeConfirmError":null},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"mcnManage":{},"tasks":{},"recentlyCreated":[]},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotListCategories":[],"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{}},"republish":{}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script src="https://static.zhihu.com/heifetz/vendor.8d94b1270b86debd0e1c.js"></script><script src="https://static.zhihu.com/heifetz/column.app.3393c53e2bde3e4fdce8.js"></script><script src="https://hm.baidu.com/hm.js?98beee57fd2ef70ccdd5ca52b9740c49" async=""></script><script src="https://unpkg.zhimg.com/za-js-sdk@2.24.6/dist/zap.js"></script><script src="https://zz.bdstatic.com/linksubmit/push.js"></script><div><div style="display: none;">想来知乎工作？请发送邮件到 jobs@zhihu.com</div></div><div><div><div class="css-8pdeid"></div></div></div><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete10-0" id="Popover9-toggle" aria-haspopup="true" aria-owns="Popover9-content" class="Input" placeholder="选择语言" value="" /><svg xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Select" fill="#afbdcf" viewBox="0 0 24 24" width="24" height="24"><path d="M12 16.183l2.716-2.966a.757.757 0 0 1 1.064.001.738.738 0 0 1 0 1.052l-3.247 3.512a.758.758 0 0 1-1.064 0L8.22 14.27a.738.738 0 0 1 0-1.052.758.758 0 0 1 1.063 0L12 16.183zm0-9.365L9.284 9.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l3.248-3.512a.758.758 0 0 1 1.065 0L15.78 8.73a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063.001L12 6.818z" fill-rule="evenodd"/></svg></label></div></div></div></div></div></body></html>